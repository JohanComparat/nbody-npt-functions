<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>HaloSelection &#8212; pySU, python Skies and Universes 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="pySU, python Skies and Universes 1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>pySU, python Skies and Universes 1.0 documentation</span></a></h1>
        <h2 class="heading"><span>HaloSelection</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for HaloSelection</h1><div class="highlight"><pre>
<span></span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Library of function to create halo catalogs matched to a density.</span>

<span class="sd">.. moduleauthor:: Johan Comparat &lt;johan.comparat__at__gmail.com&gt;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">p</span>
<span class="kn">import</span> <span class="nn">astropy.io.fits</span> <span class="k">as</span> <span class="nn">fits</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">n</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">interp1d</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">join</span>

<div class="viewcode-block" id="MultiDarkMock"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock">[docs]</a><span class="k">class</span> <span class="nc">MultiDarkMock</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param hdu: hdu of the lightcone</span>
<span class="sd">    :param area: area in deg2</span>
<span class="sd">    :param mockOutput_dir: directory where to output mocks</span>
<span class="sd">    :param mockName: name of the file where to save the mock</span>
<span class="sd">    :param zmin: minimum redshift array defining the bins</span>
<span class="sd">    :param zmax: maximum redshift array defining the bins</span>
<span class="sd">    :param nGal_Deg2: number of galaxies per square degrees </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">hdu</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">mockOutput_dir</span><span class="p">,</span> <span class="n">mockName</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">nGal_Deg2</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span> <span class="o">=</span> <span class="n">hdu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mockOutput_dir</span> <span class="o">=</span> <span class="n">mockOutput_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mockName</span> <span class="o">=</span> <span class="n">mockName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zmin</span> <span class="o">=</span> <span class="n">zmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zmax</span> <span class="o">=</span> <span class="n">zmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nGal_Deg2</span> <span class="o">=</span> <span class="n">nGal_Deg2</span>
        
<div class="viewcode-block" id="MultiDarkMock.initialize"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the procedure by putting into memroy arrays of central and satellites.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># derived numbers common to all SHAMs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cen</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;pid&#39;</span><span class="p">]</span> <span class="o">==</span>  <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sat</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cen</span> <span class="o">==</span>  <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nhalos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAXIS2&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IDh</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nhalos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nGal</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="nb">int</span><span class="p">(</span><span class="n">el</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>  <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nGal_Deg2</span> <span class="p">])</span>
        <span class="c1">#self.nGal_to_z = interp1d(nGal_Deg2,(self.zmax+self.zmin)/2.)</span>
        <span class="c1">#function to slice by redshift </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slice_Z</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span> <span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z_redshift_space&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">z1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z_redshift_space&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">z2</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiDarkMock.write_catalog_ascii"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.write_catalog_ascii">[docs]</a>    <span class="k">def</span> <span class="nf">write_catalog_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes the obtained mock catalog for clustering estimation: just ra, dec and redshift. &quot;&quot;&quot;</span>
        <span class="nb">print</span> <span class="s2">&quot;writes ascii catalog :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockName</span>
        <span class="n">outPutFileName</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockOutput_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockName</span> <span class="o">+</span> <span class="s2">&quot;_radecz.cat&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raMock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">idSel</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decMock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">idSel</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zMock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;z_redshift_space&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">idSel</span><span class="p">]</span>
        <span class="n">n</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">outPutFileName</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span> <span class="bp">self</span><span class="o">.</span><span class="n">raMock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">decMock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zMock</span><span class="p">]),</span><span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.8f</span><span class="s1"> </span><span class="si">%.8f</span><span class="s1"> </span><span class="si">%.5f</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiDarkMock.write_full_catalog_fits"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.write_full_catalog_fits">[docs]</a>    <span class="k">def</span> <span class="nf">write_full_catalog_fits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes the obtained with all the columns from the parent lightcone catalog.&quot;&quot;&quot;</span>
        <span class="nb">print</span> <span class="s2">&quot;writes fits catalog :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockName</span>
        <span class="n">tbhdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">BinTableHDU</span><span class="o">.</span><span class="n">from_columns</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span> <span class="p">)</span>
        <span class="n">tbhdu</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">tbhdu</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idSel</span><span class="p">]</span>
        <span class="n">prihdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>
        <span class="n">thdulist</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">([</span><span class="n">prihdu</span><span class="p">,</span> <span class="n">tbhdu</span><span class="p">])</span>
        <span class="n">outPutFileName</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mockOutput_dir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mockName</span><span class="o">+</span><span class="s2">&quot;_allCols.fits&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;rm -rf &#39;</span><span class="o">+</span> <span class="n">outPutFileName</span><span class="p">)</span>
        <span class="n">thdulist</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">outPutFileName</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiDarkMock.get_distrib_QTY"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.get_distrib_QTY">[docs]</a>    <span class="k">def</span> <span class="nf">get_distrib_QTY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colN</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the cumulative histogram of a column for halos in the range z1, z2.</span>
<span class="sd">        :param colN: name of the column you want to take the histogram.</span>
<span class="sd">        :param z1: minimum redshift</span>
<span class="sd">        :param z2: maximum redshift</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">zsel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_Z</span><span class="p">(</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">)</span>
        <span class="n">IDhz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IDh</span><span class="p">[</span><span class="n">zsel</span><span class="p">]</span> <span class="c1"># all ids in this redshift bin</span>
        <span class="n">QTY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">colN</span><span class="p">][</span><span class="n">zsel</span><span class="p">]</span> <span class="c1"># all QTY in this redshift bin</span>
        <span class="n">nn</span><span class="p">,</span><span class="n">bb</span><span class="p">,</span><span class="n">pp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">QTY</span><span class="p">,</span><span class="n">cumulative</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">bins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">QTY</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="nb">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">IDhz</span><span class="p">),</span> <span class="s2">&quot;halos with &quot;</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span> <span class="s2">&quot;&lt;z&lt;&quot;</span><span class="p">,</span> <span class="n">z2</span>
        <span class="k">return</span> <span class="n">IDhz</span><span class="p">,</span><span class="n">QTY</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">bb</span></div>

<div class="viewcode-block" id="MultiDarkMock.select_sham"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.select_sham">[docs]</a>    <span class="k">def</span> <span class="nf">select_sham</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nGal_perbin</span><span class="p">,</span> <span class="n">IDhz</span><span class="p">,</span> <span class="n">QTY</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">bb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the ids corresponding to a given density.</span>
<span class="sd">        :param nGal_perbin: number of galaxies to be selected</span>
<span class="sd">        :param IDhz: parent ID distribution</span>
<span class="sd">        :param QTY: quantity to select halos on</span>
<span class="sd">        :param nn: cumulative distribution o QTY</span>
<span class="sd">        :param bb: bins of the cumulative distribution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mfc</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="p">(</span><span class="n">bb</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
        <span class="n">QTYmax</span> <span class="o">=</span> <span class="n">mfc</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">QTY</span><span class="p">))</span>
        <span class="n">QTYmin</span> <span class="o">=</span> <span class="n">mfc</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">QTY</span><span class="p">)</span><span class="o">-</span><span class="n">nGal_perbin</span><span class="p">)</span>
        <span class="n">qsel</span> <span class="o">=</span> <span class="p">(</span><span class="n">QTY</span><span class="o">&gt;</span><span class="n">QTYmin</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">QTY</span><span class="o">&lt;=</span> <span class="n">QTYmax</span><span class="p">)</span>
        <span class="n">IDhzq</span> <span class="o">=</span> <span class="n">IDhz</span><span class="p">[</span><span class="n">qsel</span><span class="p">]</span>
        <span class="nb">print</span> <span class="s2">&quot;N to be selected:&quot;</span><span class="p">,</span><span class="n">nGal_perbin</span><span class="p">,</span><span class="s2">&quot;, Nselected:&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">IDhzq</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">IDhzq</span></div>

<div class="viewcode-block" id="MultiDarkMock.make_sham_catalog"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.make_sham_catalog">[docs]</a>    <span class="k">def</span> <span class="nf">make_sham_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colN</span><span class="o">=</span><span class="s1">&#39;mvir&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates lists of ids of halos corresponding to the density given in the n(z). </span>
<span class="sd">        For every bin of redshift, it gets the distribution o fthe column of interest and matches to the density of galaxies in the NZ given.</span>
<span class="sd">        Then provides a column of ids extracted from teh lightcone.</span>
<span class="sd">        :param colN: name of the column you wish to work on for the sham.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">)):</span> 
            <span class="nb">print</span> <span class="s2">&quot;gets all halos for &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot;&lt;z&lt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot;with col5 to mock &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nGal</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot; galaxies.&quot;</span> 
            <span class="n">IDhz</span><span class="p">,</span> <span class="n">QTY</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">bb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distrib_QTY</span><span class="p">(</span> <span class="n">colN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_sham</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nGal</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">IDhz</span><span class="p">,</span> <span class="n">QTY</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span><span class="n">bb</span><span class="p">))</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">idSel</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span> <span class="n">ids</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NhaloMock</span> <span class="o">=</span> <span class="nb">len</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">idSel</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="MultiDarkMock.select_shamIncomplete"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.select_shamIncomplete">[docs]</a>    <span class="k">def</span> <span class="nf">select_shamIncomplete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incompFactor</span><span class="p">,</span> <span class="n">nGal_perbin</span><span class="p">,</span> <span class="n">IDhz</span><span class="p">,</span> <span class="n">QTY</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">bb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the ids corresponding to a given density and an incompleteness factor.</span>
<span class="sd">        :param nGal_perbin: number of galaxies to be selected</span>
<span class="sd">        :param IDhz: parent ID distribution</span>
<span class="sd">        :param QTY: quantity to select halos on</span>
<span class="sd">        :param nn: cumulative distribution o QTY</span>
<span class="sd">        :param bb: bins of the cumulative distribution</span>
<span class="sd">        :param incompFactor: incompleteness factor compared to the max of QTY : max(QTY)/incompFactor will be set as the max of the extracted distribution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mfc</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">nn</span><span class="p">,(</span><span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">bb</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
        <span class="n">mfcInv</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">((</span><span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">bb</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">nn</span><span class="p">)</span>
        <span class="n">QTYmaxAll</span> <span class="o">=</span> <span class="n">mfc</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">QTY</span><span class="p">))</span><span class="o">/</span><span class="n">incompFactor</span>
        <span class="n">Nmax</span> <span class="o">=</span> <span class="n">mfcInv</span><span class="p">(</span><span class="n">QTYmaxAll</span><span class="p">)</span>
        <span class="n">QTYmax</span> <span class="o">=</span> <span class="n">mfc</span><span class="p">(</span><span class="n">Nmax</span><span class="p">)</span>
        <span class="n">QTYmin</span> <span class="o">=</span> <span class="n">mfc</span><span class="p">(</span><span class="n">Nmax</span><span class="o">-</span><span class="n">nGal_perbin</span><span class="p">)</span>
        <span class="n">qsel</span> <span class="o">=</span> <span class="p">(</span><span class="n">QTY</span><span class="o">&gt;</span><span class="n">QTYmin</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">QTY</span><span class="o">&lt;=</span> <span class="n">QTYmax</span><span class="p">)</span>
        <span class="n">IDhzq</span> <span class="o">=</span> <span class="n">IDhz</span><span class="p">[</span><span class="n">qsel</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">IDhzq</span></div>
        
<div class="viewcode-block" id="MultiDarkMock.make_shamIncomplete_catalog"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.make_shamIncomplete_catalog">[docs]</a>    <span class="k">def</span> <span class="nf">make_shamIncomplete_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colN</span><span class="p">,</span> <span class="n">incompletenessFactor</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates lists of ids of halos corresponding to the density given in the n(z). </span>
<span class="sd">        For every bin of redshift, it gets the distribution o fthe column of interest and matches to the density of galaxies in the NZ given.</span>
<span class="sd">        Then provides a column of ids extracted from teh lightcone.</span>
<span class="sd">        :param colN: name of the column you wish to work on for the sham.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">)):</span>
            <span class="nb">print</span> <span class="s2">&quot;gets all halos for &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot;&lt;z&lt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot;with col5 to mock &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nGal</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot; galaxies.&quot;</span> 
            <span class="n">IDhz</span><span class="p">,</span> <span class="n">QTY</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">bb</span> <span class="o">=</span> <span class="n">get_distrib_QTY</span><span class="p">(</span> <span class="n">hdu</span><span class="p">,</span> <span class="n">colN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_shamIncomplete</span><span class="p">(</span> <span class="n">incompletenessFactor</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nGal</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">IDhz</span><span class="p">,</span> <span class="n">QTY</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">bb</span> <span class="p">)</span> <span class="p">)</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">idSel</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span> <span class="n">ids</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NhaloMock</span> <span class="o">=</span> <span class="nb">len</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">idSel</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="MultiDarkMock.select_shamMAX"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.select_shamMAX">[docs]</a>    <span class="k">def</span> <span class="nf">select_shamMAX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">QTY_max</span><span class="p">,</span> <span class="n">nGal_perbin</span><span class="p">,</span><span class="n">IDhz</span><span class="p">,</span> <span class="n">QTY</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span><span class="n">bb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the ids corresponding to a given density with a maximum in the QTY.</span>
<span class="sd">        :param nGal_perbin: number of galaxies to be selected</span>
<span class="sd">        :param IDhz: parent ID distribution</span>
<span class="sd">        :param QTY: quantity to select halos on</span>
<span class="sd">        :param nn: cumulative distribution o QTY</span>
<span class="sd">        :param bb: bins of the cumulative distribution</span>
<span class="sd">        :param QTY_max: the max of QTY is set to QTY_max.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mfc</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">nn</span><span class="p">,(</span><span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">bb</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
        <span class="n">mfcInv</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">((</span><span class="n">bb</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">bb</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">nn</span><span class="p">)</span>
        <span class="n">Nmax</span> <span class="o">=</span> <span class="n">mfcInv</span><span class="p">(</span><span class="n">QTY_max</span><span class="p">)</span>
        <span class="n">QTYmax</span> <span class="o">=</span> <span class="n">mfc</span><span class="p">(</span><span class="n">Nmax</span><span class="p">)</span>
        <span class="n">QTYmin</span> <span class="o">=</span> <span class="n">mfc</span><span class="p">(</span><span class="n">Nmax</span><span class="o">-</span><span class="n">nGal_perbin</span><span class="p">)</span>
        <span class="n">qsel</span> <span class="o">=</span> <span class="p">(</span><span class="n">QTY</span><span class="o">&gt;</span><span class="n">QTYmin</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">QTY</span><span class="o">&lt;=</span> <span class="n">QTYmax</span><span class="p">)</span>
        <span class="n">IDhzq</span> <span class="o">=</span> <span class="n">IDhz</span><span class="p">[</span><span class="n">qsel</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">IDhzq</span></div>

<div class="viewcode-block" id="MultiDarkMock.make_shamMAX_catalog"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.make_shamMAX_catalog">[docs]</a>    <span class="k">def</span> <span class="nf">make_shamMAX_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colN</span><span class="p">,</span> <span class="n">maxQTY</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates lists of ids of centrals and satellite galaxies corresponding to the density given in the n(z). </span>
<span class="sd">        For every bin of redshift, it gets the distribution o fthe column of interest and matches to the density of galaxies in the NZ given.</span>
<span class="sd">        Then provides a column of ids extracted from teh lightcone.</span>
<span class="sd">        :param colN: name of the column you wish to work on for the sham.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">)):</span>
            <span class="nb">print</span> <span class="s2">&quot;gets all halos for &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot;&lt;z&lt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot;with col5 to mock &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nGal</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot; galaxies.&quot;</span> 
            <span class="n">IDhz</span><span class="p">,</span> <span class="n">QTY</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">bb</span> <span class="o">=</span> <span class="n">get_distrib_QTY</span><span class="p">(</span> <span class="n">hdu</span><span class="p">,</span> <span class="n">colN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_shamMAX</span><span class="p">(</span> <span class="n">maxQTY</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nGal</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">IDhz</span><span class="p">,</span> <span class="n">QTY</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">bb</span> <span class="p">)</span> <span class="p">)</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">idSel</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span> <span class="n">ids</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NhaloMock</span> <span class="o">=</span> <span class="nb">len</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">idSel</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="MultiDarkMock.select_Gaussian"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.select_Gaussian">[docs]</a>    <span class="k">def</span> <span class="nf">select_Gaussian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meanQTY</span><span class="p">,</span> <span class="n">scatterQTY</span><span class="p">,</span> <span class="n">nGal_perbin</span><span class="p">,</span> <span class="n">IDhz</span><span class="p">,</span> <span class="n">QTY</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates lists of ids of centrals and satellite galaxies corresponding to the density given in the n(z) and to a gaussian distribution . </span>
<span class="sd">        For every bin of redshift, it gets the distribution o fthe column of interest and matches to the density of galaxies in the NZ given.</span>
<span class="sd">        Then provides a column of ids extracted from teh lightcone.</span>
<span class="sd">        :param colN: name of the column you wish to work on for the sham.</span>
<span class="sd">        :param meanQTY: mean of the distribution</span>
<span class="sd">        :param scatterQTY: scatter of the distribution</span>
<span class="sd">        :param nGal_perbin: total number of galaxies in this bins to mock</span>
<span class="sd">        :param IDhz: IDs of the halos in this bin</span>
<span class="sd">        :param QTY: array of the column to do the match on, mass, velocity, ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># constructs the QTY intervals around the distribution</span>
        <span class="n">expected_cdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">meanQTY</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">scatterQTY</span><span class="p">)</span>
        <span class="n">interval</span>  <span class="o">=</span>  <span class="p">[</span> <span class="n">meanQTY</span> <span class="o">-</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">scatterQTY</span> <span class="p">,</span> <span class="n">meanQTY</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">scatterQTY</span><span class="p">]</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">],(</span><span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">expected_cdf</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
        <span class="n">expected_cdf_inv</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">xs</span><span class="p">)</span>
        <span class="n">boundaries</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">expected_cdf_inv</span><span class="p">(</span><span class="mf">0.01</span><span class="p">),</span><span class="n">expected_cdf_inv</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.91</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)),</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="c1"># gets the number of halos to select</span>
        <span class="n">expected_cdf_tot</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">nGal_perbin</span> <span class="o">*</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">meanQTY</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">scatterQTY</span><span class="p">)</span>
        <span class="n">Up</span> <span class="o">=</span> <span class="n">expected_cdf_tot</span><span class="p">(</span><span class="n">boundaries</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">Low</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">expected_cdf_tot</span><span class="p">(</span><span class="n">boundaries</span><span class="p">[</span><span class="mi">1</span><span class="p">:])[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">))</span>
        <span class="n">N2select</span> <span class="o">=</span> <span class="n">Up</span><span class="o">-</span><span class="n">Low</span>
        <span class="nb">print</span> <span class="n">N2select</span><span class="p">,</span><span class="n">Up</span><span class="p">,</span><span class="n">Low</span>
        <span class="c1"># select in mass in the box</span>
        <span class="n">qsels</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="p">(</span><span class="n">QTY</span><span class="o">&gt;</span><span class="n">boundaries</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">QTY</span><span class="o">&lt;=</span> <span class="n">boundaries</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">boundaries</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
        <span class="n">IDhzqAll</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">IDhz</span><span class="p">[</span><span class="n">qs</span><span class="p">]</span> <span class="k">for</span> <span class="n">qs</span> <span class="ow">in</span> <span class="n">qsels</span> <span class="p">])</span>
        <span class="c1"># random downsample to the N2select in each bin</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ids_selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">IDhzqAll</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
            <span class="n">ids_selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arr</span><span class="p">[:</span><span class="n">N2select</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="n">i</span><span class="o">+=</span> <span class="mi">1</span>

        <span class="n">ids_selected</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ids_selected</span><span class="p">)</span> <span class="p">))</span>
        <span class="k">return</span> <span class="n">ids_selected</span></div>

<div class="viewcode-block" id="MultiDarkMock.make_Gaussian_catalog"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.make_Gaussian_catalog">[docs]</a>    <span class="k">def</span> <span class="nf">make_Gaussian_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colN</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">scatters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates lists of ids of centrals and satellite galaxies corresponding to the density given in the n(z).</span>
<span class="sd">        :param colN: name of the column you construct the catalog with</span>
<span class="sd">        :param means: means of the Gaussians, array the same length of the redshift bin</span>
<span class="sd">        :param scatters: scatters of the Gaussians, array the same length of the redshift bin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">)):</span>
            <span class="nb">print</span> <span class="s2">&quot;gets all halos for &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot;&lt;z&lt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot;with col5 to mock &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nGal</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot; galaxies.&quot;</span> 
            <span class="n">IDhz</span><span class="p">,</span> <span class="n">QTY</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">bb</span> <span class="o">=</span> <span class="n">get_distrib_QTY</span><span class="p">(</span> <span class="n">hdu</span><span class="p">,</span> <span class="n">colN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_Gaussian</span><span class="p">(</span> <span class="n">means</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">scatters</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nGal</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">IDhz</span><span class="p">,</span> <span class="n">QTY</span> <span class="p">)</span> <span class="p">)</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">idSel</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span> <span class="n">ids</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NhaloMock</span> <span class="o">=</span> <span class="nb">len</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">idSel</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span></div>
        
<div class="viewcode-block" id="MultiDarkMock.get_distrib_QTY_cen"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.get_distrib_QTY_cen">[docs]</a>    <span class="k">def</span> <span class="nf">get_distrib_QTY_cen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colN</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the cumulative histogram of a column for central halos in the range z1, z2.</span>
<span class="sd">        :param colN: name of the column you want to take the histogram.</span>
<span class="sd">        :param z1: minimum redshift</span>
<span class="sd">        :param z2: maximum redshift</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">zsel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_Z</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cen</span><span class="p">)</span>
        <span class="n">IDhz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IDh</span><span class="p">[</span><span class="n">zsel</span><span class="p">]</span> <span class="c1"># all ids in this redshift bin</span>
        <span class="n">QTY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">colN</span><span class="p">][</span><span class="n">zsel</span><span class="p">]</span> <span class="c1"># all QTY in this redshift bin</span>
        <span class="n">nn</span><span class="p">,</span><span class="n">bb</span><span class="p">,</span><span class="n">pp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">QTY</span><span class="p">,</span><span class="n">cumulative</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">bins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">QTY</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">IDhz</span><span class="p">,</span><span class="n">QTY</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">bb</span></div>

<div class="viewcode-block" id="MultiDarkMock.get_distrib_QTY_sat"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.get_distrib_QTY_sat">[docs]</a>    <span class="k">def</span> <span class="nf">get_distrib_QTY_sat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colN</span><span class="p">,</span> <span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the cumulative histogram of a column for satellite halos in the range z1, z2.</span>
<span class="sd">        :param colN: name of the column you want to take the histogram.</span>
<span class="sd">        :param z1: minimum redshift</span>
<span class="sd">        :param z2: maximum redshift</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">zsel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slice_Z</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sat</span><span class="p">)</span>
        <span class="n">IDhz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IDh</span><span class="p">[</span><span class="n">zsel</span><span class="p">]</span> <span class="c1"># all ids in this redshift bin</span>
        <span class="n">QTY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">colN</span><span class="p">][</span><span class="n">zsel</span><span class="p">]</span> <span class="c1"># all QTY in this redshift bin</span>
        <span class="n">nn</span><span class="p">,</span><span class="n">bb</span><span class="p">,</span><span class="n">pp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">QTY</span><span class="p">,</span><span class="n">cumulative</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">bins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">QTY</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">IDhz</span><span class="p">,</span><span class="n">QTY</span><span class="p">,</span><span class="n">nn</span><span class="p">,</span><span class="n">bb</span></div>

<div class="viewcode-block" id="MultiDarkMock.select_GaussianFsat"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.select_GaussianFsat">[docs]</a>    <span class="k">def</span> <span class="nf">select_GaussianFsat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">meanQTY</span><span class="p">,</span><span class="n">scatterQTY</span><span class="p">,</span><span class="n">fsat</span><span class="p">,</span> <span class="n">nGal_perbin</span><span class="p">,</span> <span class="n">IDhz_c</span><span class="p">,</span> <span class="n">QTY_c</span><span class="p">,</span> <span class="n">IDhz_s</span><span class="p">,</span> <span class="n">QTY_s</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts the ids of halos to create a mock with a Gaussian distribution.</span>
<span class="sd">        :param colN: name of the column you wish to work on for the sham.</span>
<span class="sd">        :param meanQTY: mean of the distribution</span>
<span class="sd">        :param scatterQTY: scatter of the distribution</span>
<span class="sd">        :param fsat: fraction of satellite in this bin</span>
<span class="sd">        :param nGal_perbin: total number of galaxies in this bins to mock</span>
<span class="sd">        :param IDhz_c: IDs of the central halos in this bin</span>
<span class="sd">        :param QTY_c: column to do the match on, mass, velocity, ... for the central halos</span>
<span class="sd">        :param IDhz_s: IDs of the satellite halos in this bin</span>
<span class="sd">        :param QTY_s: column to do the match on, mass, velocity, ... for the satellite halos</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nSat</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nGal_perbin</span><span class="o">*</span><span class="n">fsat</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s2">&quot;satellites&quot;</span><span class="p">,</span><span class="n">nGal_perbin</span><span class="p">,</span><span class="n">nSat</span><span class="p">,</span><span class="n">fsat</span><span class="p">,</span><span class="n">meanQTY</span><span class="p">,</span><span class="n">scatterQTY</span>
        <span class="c1"># constructs the QTY intervals around the distribution </span>
        <span class="n">expected_cdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">meanQTY</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">scatterQTY</span><span class="p">)</span>
        <span class="n">interval</span>  <span class="o">=</span>  <span class="p">[</span> <span class="n">meanQTY</span> <span class="o">-</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">scatterQTY</span> <span class="p">,</span> <span class="n">meanQTY</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">scatterQTY</span><span class="p">]</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">],(</span><span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">expected_cdf</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
        <span class="n">expected_cdf_inv</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">xs</span><span class="p">)</span>
        <span class="n">boundaries</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">expected_cdf_inv</span><span class="p">(</span><span class="mf">0.01</span><span class="p">),</span><span class="n">expected_cdf_inv</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.91</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)),</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="c1"># gets the number of halos to select the SAT</span>
        <span class="n">expected_cdf_s</span>  <span class="o">=</span>  <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">nSat</span> <span class="o">*</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">meanQTY</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">scatterQTY</span><span class="p">)</span>
        <span class="n">Up_s</span>  <span class="o">=</span>  <span class="n">expected_cdf_s</span><span class="p">(</span><span class="n">boundaries</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">Low_s</span>  <span class="o">=</span>  <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">expected_cdf_s</span><span class="p">(</span><span class="n">boundaries</span><span class="p">[</span><span class="mi">1</span><span class="p">:])[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">))</span>
        <span class="n">N2select_s</span>  <span class="o">=</span>  <span class="n">Up_s</span><span class="o">-</span><span class="n">Low_s</span>
        <span class="c1"># select in mass in the box</span>
        <span class="n">qsels_s</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="p">(</span><span class="n">QTY_s</span><span class="o">&gt;</span><span class="n">boundaries</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">QTY_s</span><span class="o">&lt;=</span> <span class="n">boundaries</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">boundaries</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
        <span class="n">IDhzqAll_s</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">IDhz_s</span><span class="p">[</span><span class="n">qs</span><span class="p">]</span> <span class="k">for</span> <span class="n">qs</span> <span class="ow">in</span> <span class="n">qsels_s</span> <span class="p">])</span>

        <span class="c1"># random downsample to the N2select in each bin</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ids_selected_s</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arr2</span> <span class="ow">in</span> <span class="n">IDhzqAll_s</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">arr2</span><span class="p">)</span>
            <span class="c1">#print len(arr2),int(N2select_s[i])</span>
            <span class="n">ids_selected_s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arr2</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">N2select_s</span><span class="p">[</span><span class="n">i</span><span class="p">])])</span>
            <span class="n">i</span><span class="o">+=</span> <span class="mi">1</span>

        <span class="n">id_s</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ids_selected_s</span><span class="p">)))</span>

        <span class="n">nSatReal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_s</span><span class="p">)</span>
        <span class="n">nCen</span> <span class="o">=</span> <span class="n">nGal_perbin</span><span class="o">-</span><span class="n">nSatReal</span>
        <span class="nb">print</span> <span class="s2">&quot;centrals&quot;</span><span class="p">,</span> <span class="n">nGal_perbin</span><span class="p">,</span><span class="n">nSat</span><span class="p">,</span><span class="n">nCen</span><span class="p">,</span><span class="n">fsat</span><span class="p">,</span><span class="n">meanQTY</span><span class="p">,</span><span class="n">scatterQTY</span>

        <span class="c1"># gets the number of halos to select the CEN, compatible with the sat fraction to get the right density.</span>
        <span class="nb">print</span> <span class="s2">&quot;centrals&quot;</span>
        <span class="n">expected_cdf_c</span>  <span class="o">=</span>  <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">nCen</span> <span class="o">*</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">meanQTY</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">scatterQTY</span><span class="p">)</span>
        <span class="n">Up_c</span>  <span class="o">=</span>  <span class="n">expected_cdf_c</span><span class="p">(</span><span class="n">boundaries</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">Low_c</span>  <span class="o">=</span>  <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">expected_cdf_c</span><span class="p">(</span><span class="n">boundaries</span><span class="p">[</span><span class="mi">1</span><span class="p">:])[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">))</span>
        <span class="n">N2select_c</span>  <span class="o">=</span>  <span class="n">Up_c</span><span class="o">-</span><span class="n">Low_c</span>
        <span class="c1"># select in mass in the box</span>
        <span class="n">qsels_c</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="p">(</span><span class="n">QTY_c</span><span class="o">&gt;</span><span class="n">boundaries</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">QTY_c</span><span class="o">&lt;=</span> <span class="n">boundaries</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">boundaries</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
        <span class="n">IDhzqAll_c</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">IDhz_c</span><span class="p">[</span><span class="n">qs</span><span class="p">]</span> <span class="k">for</span> <span class="n">qs</span> <span class="ow">in</span> <span class="n">qsels_c</span> <span class="p">])</span>

        <span class="c1"># random downsample to the N2select in each bin</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ids_selected_c</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">IDhzqAll_c</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
            <span class="c1">#print len(arr),int(N2select_c[i])</span>
            <span class="n">ids_selected_c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arr</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">N2select_c</span><span class="p">[</span><span class="n">i</span><span class="p">])])</span>
            <span class="n">i</span><span class="o">+=</span> <span class="mi">1</span>

        <span class="n">id_c</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ids_selected_c</span><span class="p">)))</span>

        <span class="n">ids_selected</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">id_c</span><span class="p">,</span><span class="n">id_s</span> <span class="p">))</span>
        <span class="nb">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_c</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">id_s</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">ids_selected</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ids_selected</span></div>


<div class="viewcode-block" id="MultiDarkMock.make_GaussianFsat_catalog"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.make_GaussianFsat_catalog">[docs]</a>    <span class="k">def</span> <span class="nf">make_GaussianFsat_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colN</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">scatters</span><span class="p">,</span> <span class="n">fsats</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates lists of ids of centrals and satellite galaxies corresponding to the density given in the n(z).</span>
<span class="sd">        :param colN: name of the column you construct the catalog with</span>
<span class="sd">        :param means: means of the Gaussians, array the same length of the redshift bin</span>
<span class="sd">        :param scatters: scatters of the Gaussians, array the same length of the redshift bin</span>
<span class="sd">        :param fsats: fractions of satellite, array the same length of the redshift bin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">)):</span>
            <span class="nb">print</span> <span class="s2">&quot;gets all halos for &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="s2">&quot;&lt;z&lt;&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot;with col5 to mock &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nGal</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot; galaxies.&quot;</span> 
            <span class="n">IDhz_c</span><span class="p">,</span><span class="n">QTY_c</span><span class="p">,</span><span class="n">nn_c</span><span class="p">,</span><span class="n">bb_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distrib_QTY_cen</span><span class="p">(</span> <span class="n">colN</span><span class="p">,</span> <span class="n">z1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">z2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">IDhz_s</span><span class="p">,</span><span class="n">QTY_s</span><span class="p">,</span><span class="n">nn_s</span><span class="p">,</span><span class="n">bb_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distrib_QTY_sat</span><span class="p">(</span> <span class="n">colN</span><span class="p">,</span> <span class="n">z1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">z2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_GaussianFsat</span><span class="p">(</span> <span class="n">means</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">scatters</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">fsats</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nGal</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">IDhz_c</span><span class="p">,</span> <span class="n">QTY_c</span><span class="p">,</span> <span class="n">IDhz_s</span><span class="p">,</span> <span class="n">QTY_s</span>  <span class="p">)</span> <span class="p">)</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">idSel</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span> <span class="n">ids</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NhaloMock</span> <span class="o">=</span> <span class="nb">len</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">idSel</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="MultiDarkMock.select_LogNorm"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.select_LogNorm">[docs]</a>    <span class="k">def</span> <span class="nf">select_LogNorm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meanQTY</span><span class="p">,</span> <span class="n">scatterQTY</span><span class="p">,</span> <span class="n">nGal_perbin</span><span class="p">,</span><span class="n">IDhz</span><span class="p">,</span> <span class="n">QTY</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span><span class="n">bb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates lists of ids of centrals and satellite galaxies corresponding to the density given in the n(z) and to a gaussian distribution . </span>
<span class="sd">        For every bin of redshift, it gets the distribution o fthe column of interest and matches to the density of galaxies in the NZ given.</span>
<span class="sd">        Then provides a column of ids extracted from teh lightcone.</span>
<span class="sd">        :param colN: name of the column you wish to work on for the sham.</span>
<span class="sd">        :param meanQTY: mean of the distribution</span>
<span class="sd">        :param scatterQTY: scatter of the distribution</span>
<span class="sd">        :param nGal_perbin: total number of galaxies in this bins to mock</span>
<span class="sd">        :param IDhz: IDs of the halos in this bin</span>
<span class="sd">        :param QTY: array of the column to do the match on, mass, velocity, ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># constructs the QTY intervals around the distribution</span>
        <span class="n">expected_cdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">lognorm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">meanQTY</span><span class="p">,</span> <span class="n">scatterQTY</span><span class="p">)</span>
        <span class="n">interval</span>  <span class="o">=</span>  <span class="p">[</span> <span class="n">meanQTY</span> <span class="o">-</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">scatterQTY</span> <span class="p">,</span> <span class="n">meanQTY</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">scatterQTY</span><span class="p">]</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">],(</span><span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">expected_cdf</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
        <span class="n">expected_cdf_inv</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">xs</span><span class="p">)</span>
        <span class="n">boundaries</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">expected_cdf_inv</span><span class="p">(</span><span class="mf">0.01</span><span class="p">),</span><span class="n">expected_cdf_inv</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.91</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)),</span> <span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="c1"># gets the number of halos to select</span>
        <span class="n">expected_cdf_tot</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">nGal_perbin</span> <span class="o">*</span> <span class="n">st</span><span class="o">.</span><span class="n">lognorm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">meanQTY</span><span class="p">,</span> <span class="n">scatterQTY</span><span class="p">)</span>
        <span class="n">Up</span> <span class="o">=</span> <span class="n">expected_cdf_tot</span><span class="p">(</span><span class="n">boundaries</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">Low</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">expected_cdf_tot</span><span class="p">(</span><span class="n">boundaries</span><span class="p">[</span><span class="mi">1</span><span class="p">:])[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">))</span>
        <span class="n">N2select</span> <span class="o">=</span> <span class="n">Up</span><span class="o">-</span><span class="n">Low</span>
        <span class="c1">#print N2select,Up,Low</span>
        <span class="c1"># select in mass in the box</span>
        <span class="n">qsels</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="p">(</span><span class="n">QTY</span><span class="o">&gt;</span><span class="n">boundaries</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">QTY</span><span class="o">&lt;=</span> <span class="n">boundaries</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">boundaries</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
        <span class="n">IDhzqAll</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">IDhz</span><span class="p">[</span><span class="n">qs</span><span class="p">]</span> <span class="k">for</span> <span class="n">qs</span> <span class="ow">in</span> <span class="n">qsels</span> <span class="p">])</span>
        <span class="c1"># random downsample to the N2select in each bin</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ids_selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">IDhzqAll</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
            <span class="n">ids_selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arr</span><span class="p">[:</span><span class="n">N2select</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="n">i</span><span class="o">+=</span> <span class="mi">1</span>

        <span class="n">ids_selected</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ids_selected</span><span class="p">)</span> <span class="p">))</span>
        <span class="k">return</span> <span class="n">ids_selected</span></div>

<div class="viewcode-block" id="MultiDarkMock.make_LogNorm_catalog"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.make_LogNorm_catalog">[docs]</a>    <span class="k">def</span> <span class="nf">make_LogNorm_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colN</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">scatters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates lists of ids of centrals and satellite galaxies corresponding to the density given in the n(z).</span>
<span class="sd">        :param colN: name of the column you construct the catalog with</span>
<span class="sd">        :param means: means of the Gaussians, array the same length of the redshift bin</span>
<span class="sd">        :param scatters: scatters of the Gaussians, array the same length of the redshift bin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">)):</span>
            <span class="nb">print</span> <span class="s2">&quot;gets all halos for &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot;&lt;z&lt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot;with col5 to mock &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nGal</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="s2">&quot; galaxies.&quot;</span> 
            <span class="n">IDhz</span><span class="p">,</span> <span class="n">QTY</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">bb</span> <span class="o">=</span> <span class="n">get_distrib_QTY</span><span class="p">(</span> <span class="n">hdu</span><span class="p">,</span> <span class="n">colN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmin</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_LogNorm</span><span class="p">(</span> <span class="n">means</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">scatters</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nGal</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">IDhz</span><span class="p">,</span> <span class="n">QTY</span> <span class="p">)</span> <span class="p">)</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">idSel</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span> <span class="n">ids</span> <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NhaloMock</span> <span class="o">=</span> <span class="nb">len</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">idSel</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="MultiDarkMock.create_random_catalog"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.create_random_catalog">[docs]</a>    <span class="k">def</span> <span class="nf">create_random_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span> <span class="o">=</span> <span class="mf">5.</span><span class="p">,</span> <span class="n">dz</span><span class="o">=</span><span class="mf">0.025</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Writes a random catalog&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nRandom</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NhaloMock</span> <span class="o">*</span> <span class="n">factor</span> <span class="p">)</span>
        <span class="n">raR</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raMock</span><span class="p">),</span> <span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raMock</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">nRandom</span> <span class="p">)</span>
        <span class="n">decR</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decMock</span><span class="p">),</span> <span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decMock</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">nRandom</span> <span class="p">)</span>
        <span class="n">z1</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zMock</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zMock</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>
        <span class="n">nn</span><span class="p">,</span><span class="n">bb</span><span class="p">,</span><span class="n">pp</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zMock</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">z1</span><span class="p">)</span>
        <span class="n">nz</span><span class="o">=</span><span class="n">interp1d</span><span class="p">((</span><span class="n">z1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">z1</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">factor</span><span class="o">*</span><span class="n">nn</span><span class="p">)</span>
        <span class="n">zs</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zMock</span><span class="p">),</span> <span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zMock</span><span class="p">),</span> <span class="n">dz</span><span class="p">)</span>
        <span class="n">rdsz</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">inter</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">zs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="n">zs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span> <span class="n">nz</span><span class="p">(</span> <span class="n">zs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">dz</span><span class="o">/</span><span class="mf">2.</span> <span class="p">)))</span>
            <span class="n">rdsz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inter</span><span class="p">)</span>

        <span class="n">rds</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">rdsz</span><span class="p">))</span>
        <span class="n">n</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">rds</span><span class="p">)</span>
        <span class="n">selRDS</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">raR</span><span class="p">))</span><span class="o">&lt;</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nRandom</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">raR</span><span class="p">))</span>
        <span class="n">RR</span><span class="o">=</span><span class="n">rds</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">raR</span><span class="p">[</span><span class="n">selRDS</span><span class="p">])]</span>
        <span class="nb">print</span> <span class="s2">&quot;N final&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">raR</span><span class="p">[</span><span class="n">selRDS</span><span class="p">])</span>
        <span class="n">outPutFileName</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockOutput_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockName</span> <span class="o">+</span> <span class="s2">&quot;_random.cat&quot;</span> <span class="p">)</span>
        <span class="n">n</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">outPutFileName</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">raR</span><span class="p">[</span><span class="n">selRDS</span><span class="p">],</span><span class="n">decR</span><span class="p">[</span><span class="n">selRDS</span><span class="p">],</span><span class="n">RR</span><span class="p">]),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.8f</span><span class="s1"> </span><span class="si">%.8f</span><span class="s1"> </span><span class="si">%.5f</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">raR</span><span class="p">,</span><span class="n">decR</span><span class="p">,</span><span class="n">RR</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span></div>
        
<div class="viewcode-block" id="MultiDarkMock.writeClusteringParamFile"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.writeClusteringParamFile">[docs]</a>    <span class="k">def</span> <span class="nf">writeClusteringParamFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">decade</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Writes the clustering commands that command the CUTE code, see Alonso et al. 2012 https://arxiv.org/abs/1210.1833</span>
<span class="sd">        :param type: monopole or angular or ...</span>
<span class="sd">        :param decade: string suffix that is appended if you study different scales (decades) _d1, _d2, _d3 are used for the angular clustering.&quot;&quot;&quot;</span>
        <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockOutput_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockName</span> <span class="o">+</span><span class="s2">&quot;.param2PCF_&quot;</span><span class="o">+</span><span class="nb">type</span><span class="o">+</span><span class="n">decade</span><span class="p">),</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;data_filename= &quot;</span><span class="o">+</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockOutput_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockName</span> <span class="o">+</span> <span class="s2">&quot;_radecz.cat&quot;</span> <span class="p">)</span><span class="o">+</span><span class="s2">&quot; </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;random_filename= &quot;</span><span class="o">+</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockOutput_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockName</span> <span class="o">+</span> <span class="s2">&quot;_random.cat&quot;</span> <span class="p">)</span><span class="o">+</span><span class="s2">&quot; </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;input_format= 2 </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;mask_filename= &#39;none&#39; </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;z_dist_filename= &#39;none&#39; </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;output_filename= &quot;</span><span class="o">+</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockOutput_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockName</span> <span class="p">)</span><span class="o">+</span><span class="s2">&quot;_2PCF_&quot;</span><span class="o">+</span><span class="nb">type</span><span class="o">+</span><span class="n">decade</span><span class="o">+</span><span class="s2">&quot;.dat </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;num_lines= all </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;corr_type= &quot;</span><span class="o">+</span><span class="nb">type</span><span class="o">+</span><span class="s2">&quot; </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;corr_estimator= LS </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;np_rand_fact= 5 </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;omega_M= 0.307115 </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;omega_L= 0.692885 </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;w= -1 </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;radial_aperture= 1 </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;use_pm= 0 </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;n_pix_sph= 2048 </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="MultiDarkMock.compute_clustering"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.compute_clustering">[docs]</a>    <span class="k">def</span> <span class="nf">compute_clustering</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Runs the CUTE code to estimate clustering using the LS estimator. &quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;/home2/jcomparat/code/CUTE-1.1A1/CUTE/CUTE &quot;</span><span class="o">+</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockOutput_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockName</span> <span class="o">+</span><span class="s2">&quot;.param2PCF_angular_d1&quot;</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;/home2/jcomparat/code/CUTE-1.1A2/CUTE/CUTE &quot;</span><span class="o">+</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockOutput_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockName</span> <span class="o">+</span><span class="s2">&quot;.param2PCF_angular_d2&quot;</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;/home2/jcomparat/code/CUTE-1.1A3/CUTE/CUTE &quot;</span><span class="o">+</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockOutput_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockName</span> <span class="o">+</span><span class="s2">&quot;.param2PCF_angular_d3&quot;</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;/home2/jcomparat/code/CUTE-1.1M/CUTE/CUTE &quot;</span><span class="o">+</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockOutput_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockName</span> <span class="o">+</span><span class="s2">&quot;.param2PCF_monopole&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="MultiDarkMock.compare_clustering_data_mock"><a class="viewcode-back" href="../HaloSelection.html#HaloSelection.MultiDarkMock.compare_clustering_data_mock">[docs]</a>    <span class="k">def</span> <span class="nf">compare_clustering_data_mock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_data</span><span class="p">,</span> <span class="n">xi_data</span><span class="p">,</span> <span class="n">theta_min_chi2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.3</span><span class="p">,</span>  <span class="n">theta_max_chi2</span><span class="o">=</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">w_bins</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">s_min_chi2</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">s_max_chi2</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">s_bins</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compares the clustering of the mock catalog and the clustering of the data.</span>
<span class="sd">        :param w_data: angular clustering from the data [x, y, yErr].</span>
<span class="sd">        :param xi_data: monopole clustering from the data [x, y, yErr]. &quot;&quot;&quot;</span>
        <span class="n">ths</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">theta_min_chi2</span><span class="p">,</span><span class="n">theta_max_chi2</span><span class="p">,</span><span class="n">w_bins</span><span class="p">)</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">s_min_chi2</span><span class="p">,</span><span class="n">s_max_chi2</span><span class="p">,</span><span class="n">s_bins</span><span class="p">)</span>
        
        <span class="c1"># loads the angular clustering from the mock</span>
        <span class="n">xx0</span><span class="p">,</span> <span class="n">yy0</span><span class="p">,</span> <span class="n">y2E</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span> <span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockOutput_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockName</span> <span class="p">)</span><span class="o">+</span><span class="s2">&quot;_2PCF_&quot;</span><span class="o">+</span><span class="s2">&quot;angular&quot;</span><span class="o">+</span><span class="s2">&quot;_d3&quot;</span><span class="o">+</span><span class="s2">&quot;.dat&quot;</span><span class="p">,</span><span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">xx1</span><span class="p">,</span> <span class="n">yy1</span><span class="p">,</span> <span class="n">y1E</span><span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span> <span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockOutput_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockName</span> <span class="p">)</span><span class="o">+</span><span class="s2">&quot;_2PCF_&quot;</span><span class="o">+</span><span class="s2">&quot;angular&quot;</span><span class="o">+</span><span class="s2">&quot;_d2&quot;</span><span class="o">+</span><span class="s2">&quot;.dat&quot;</span><span class="p">,</span><span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">w_M</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">xx0</span><span class="p">,</span><span class="n">xx1</span><span class="p">[</span><span class="mi">1</span><span class="p">:])),</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">yy0</span><span class="p">,</span><span class="n">yy1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="p">)</span> <span class="c1">#,yy2[1:]))</span>

        <span class="c1"># loads the monopole from the mock</span>
        <span class="n">s_M_a</span><span class="p">,</span> <span class="n">xi_M_a</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span> <span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockOutput_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mockName</span> <span class="p">)</span><span class="o">+</span><span class="s2">&quot;_2PCF_&quot;</span><span class="o">+</span><span class="s2">&quot;monopole&quot;</span><span class="o">+</span><span class="s2">&quot;.dat&quot;</span><span class="p">,</span><span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">xi_M</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span> <span class="n">s_M_a</span><span class="p">,</span> <span class="n">xi_M_a</span> <span class="p">)</span>
        <span class="c1"># loads the monopole from the mock</span>

        <span class="c1">#s_selection_data=( xi_data[0] &gt; s_min_chi2 ) &amp; ( xi_data[0] &lt; s_max_chi2 ) &amp; (xi_data[1] &gt; 2 * xi_data[2])</span>
        <span class="c1">#theta_selection_data = ( w_data[0] &gt; theta_min_chi2 ) &amp; ( w_data[0] &lt; theta_max_chi2 ) &amp; (w_data[1] &gt; 2 * w_data[2])</span>

        <span class="n">xi_D</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span> <span class="n">xi_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xi_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#[s_selection_data], xi_data[1][s_selection_data] )</span>
        <span class="n">xi_D_err</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span> <span class="n">xi_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xi_data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="c1">#[s_selection_data], xi_data[2][s_selection_data] )</span>

        <span class="n">w_D</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span> <span class="n">w_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#[theta_selection_data], w_data[1][theta_selection_data] )</span>
        <span class="n">w_D_err</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span> <span class="n">w_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w_data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="c1">#[theta_selection_data], w_data[2][theta_selection_data] )</span>

        <span class="n">chi2Wr</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">w_D</span><span class="p">(</span><span class="n">ths</span><span class="p">)</span> <span class="o">-</span> <span class="n">w_M</span><span class="p">(</span><span class="n">ths</span><span class="p">))</span><span class="o">**</span><span class="mf">2.</span> <span class="o">/</span> <span class="n">w_D_err</span><span class="p">(</span><span class="n">ths</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">ths</span><span class="p">)</span>
        <span class="n">chi2Xr</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">xi_D</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span> <span class="o">-</span> <span class="n">xi_M</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span><span class="o">**</span><span class="mf">2.</span> <span class="o">/</span> <span class="n">xi_D_err</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">chi2Wr</span><span class="p">,</span> <span class="n">chi2Xr</span></div></div>
        
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, johan comparat.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.6.
    </div>
  </body>
</html>