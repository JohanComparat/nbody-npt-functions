<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>lib_functions_1pt &mdash; N-body n-point functions 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="N-body n-point functions 1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>N-body n-point functions 1.0 documentation</span></a></h1>
        <h2 class="heading"><span>lib_functions_1pt</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for lib_functions_1pt</h1><div class="highlight"><pre>
<span></span><span class="c1"># data modules</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">astropy.io.fits</span> <span class="kn">as</span> <span class="nn">fits</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="kn">import</span> <span class="nn">cPickle</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="c1"># numerical modules</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">n</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">scipy.misc</span> <span class="kn">import</span> <span class="n">derivative</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="c1"># plotting modules</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="c1">#matplotlib.use(&#39;pdf&#39;)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">14</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">p</span>

<span class="c1"># mass function theory</span>
<span class="kn">from</span> <span class="nn">hmf</span> <span class="kn">import</span> <span class="n">MassFunction</span>
<span class="kn">from</span> <span class="nn">astropy.cosmology</span> <span class="kn">import</span> <span class="n">FlatLambdaCDM</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="kn">as</span> <span class="nn">u</span>
<span class="n">cosmoMD</span> <span class="o">=</span> <span class="n">FlatLambdaCDM</span><span class="p">(</span><span class="n">H0</span><span class="o">=</span><span class="mf">67.77</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">Mpc</span><span class="p">,</span> <span class="n">Om0</span><span class="o">=</span><span class="mf">0.307115</span><span class="p">,</span> <span class="n">Ob0</span><span class="o">=</span><span class="mf">0.048206</span><span class="p">)</span>
<span class="n">cosmoDS</span> <span class="o">=</span> <span class="n">FlatLambdaCDM</span><span class="p">(</span><span class="n">H0</span><span class="o">=</span><span class="mf">68.46</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">Mpc</span><span class="p">,</span> <span class="n">Om0</span><span class="o">=</span><span class="mf">0.298734</span><span class="p">,</span> <span class="n">Ob0</span><span class="o">=</span><span class="mf">0.046961</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>

<span class="c1"># Fitting functions</span>
<span class="c1"># velocity function</span>
<span class="n">vf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="mi">10</span><span class="o">**</span><span class="n">A</span> <span class="o">*</span> <span class="p">(</span> <span class="mf">01.</span><span class="o">+</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">v</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="n">v0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="p">))</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">e</span><span class="o">**</span><span class="p">(</span><span class="o">-</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">v</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="n">v0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">vf_ps</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">,</span> <span class="n">ps</span> <span class="p">:</span> <span class="n">vf</span><span class="p">(</span> <span class="n">v</span><span class="p">,</span> <span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd"># sheth and tormen function</span>
<span class="sd">fnu_ST = lambda nu, A, a, p: A * (2./n.pi)**(0.5) * (a*nu) * ( 1 + (a * nu) **(-2.*p) ) * n.e**( -( a * nu )**2. / 2.) </span>
<span class="sd">log_fnu_ST = lambda logNu, Anorm, a, q : n.log10( fnu_ST(10.**logNu, Anorm, a, q) )</span>
<span class="sd">log_fnu_ST_ps = lambda logNu, ps : n.log10( fnu_ST(10.**logNu, ps[0], ps[1], ps[2]) )</span>

<span class="sd">p_ST_despali = [0.333, 0.794, 0.247]</span>
<span class="sd">p_ST_sheth = [0.3222, 0.707, 0.3]</span>
<span class="sd">p_T08_klypin = [0.224, 1.67, 1.80, 1.48]</span>
<span class="sd">p_T08_RP = [0.144, 1.351, 3.113, 1.187]</span>


<span class="sd"># tinker function </span>
<span class="sd">fsigma_T08 = lambda sigma, A, a, b, c :  A *(1+ (b/sigma)**a) * n.e**(-c/sigma**2.)</span>
<span class="sd">log_fsigma_T08 = lambda  logsigma, A, a, b, c :  n.log10(A *(1+ (b/(10**logsigma))**a) * n.e**(-c/(10**logsigma)**2.))</span>
<span class="sd">log_fsigma_T08_ps = lambda logsigma, ps : log_fsigma_T08(logsigma, ps[0], ps[1], ps[2], ps[3])</span>

<span class="sd">#fnu_SMT = lambda nu, Anorm, a, q : Anorm * (2./n.pi)**(0.5) * (a*nu) * ( 1 + (a*nu) **(-2*q) ) * n.e**( - (a*nu)**2. / 2.) # </span>
<span class="sd">#fnu_SMT = lambda nu, Anorm, a, q : Anorm *a * (2.*n.pi)**(-0.5) *  ( 1 + (a**2*nu) **(-q) ) * n.e**( - a**2*nu / 2.)</span>
<span class="sd">#log_fnu_ST01 = lambda logNu, Anorm, a, q : n.log10( fnu_SMT(10.**logNu, Anorm, a, q) )</span>
<span class="sd">#log_fnu_ST01_ps = lambda logNu, ps : n.log10( fnu_SMT(10.**logNu, ps[0], ps[1], ps[2]) )</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="n">delta_c</span> <span class="o">=</span> <span class="mf">1.686</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span> <span class="c1">#n.log10(1./sigma)</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="n">X</span> 

<span class="c1">#f_dsp_nu = lambda nu, A, a, p: A* (a / (nu * 2 * n.pi))**(0.5) * ( 1 + 1. / (a*nu) **p ) * n.e**( - a * nu / 2.)</span>
<span class="c1">#nufnu_dsp = lambda nu, A, a, p: A* ((2 * a * nu) / ( n.pi))**(0.5) * ( 1 + (a*nu) **(-p) ) * n.e**( - a * nu / 2.)</span>
<span class="c1"># nu = (delta_c/sigma)**2.</span>

<span class="n">f_T08</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="p">:</span> <span class="n">A</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="n">sigma</span><span class="o">/</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">e</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">/</span><span class="n">sigma</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">f_ST</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">A</span><span class="o">*</span> <span class="p">(</span><span class="mf">2.</span><span class="o">/</span><span class="n">n</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mf">2.</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="n">delta_c</span><span class="o">*</span><span class="mf">2.</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">delta_c</span><span class="o">*</span><span class="n">a</span><span class="o">**</span><span class="mf">0.5</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">e</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">delta_c</span><span class="o">**</span><span class="mf">2.</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mf">2.</span><span class="p">))</span>
<span class="n">f_BH</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="n">A</span><span class="o">*</span> <span class="p">(</span><span class="mf">2.</span><span class="o">/</span><span class="n">n</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mf">2.</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="n">delta_c</span><span class="o">*</span><span class="mf">2.</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">delta_c</span><span class="o">*</span><span class="n">a</span><span class="o">**</span><span class="mf">0.5</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">e</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">delta_c</span><span class="o">**</span><span class="mf">2.</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mf">2.</span><span class="p">))</span>
<span class="n">b_BH</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span>  <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">delta_c</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="n">delta_c</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="o">/</span><span class="n">delta_c</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">delta_c</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">))</span><span class="o">**</span><span class="n">p</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">M200c</span>
<span class="sd">ftT08 = f_T08(sigma, 0.186, 1.47, 2.57, 1.19) </span>
<span class="sd">ftSk14 = f_T08(sigma, 0.18587, 1.46690, 2.57110, 1.19396)</span>
<span class="sd">ftK16 = f_T08(sigma, 0.224, 1.67, 1.80, 1.48) </span>
<span class="sd">ftA12 = f_T08 (sigma, 0.201, 1.7, 2.08, 1.172)</span>
<span class="sd">ftW13 = f_T08 (sigma, 0.282, 2.163, 1.406, 1.21)</span>
<span class="sd">ftST01 = f_ST(sigma, 0.3222, 0.707, 0.3)</span>
<span class="sd">#ftD16 = f_dsp(sigma, 0.287, 0.903, 0.322 )</span>
<span class="sd">ftC16 = f_T08(sigma, 0.12, 1.19, 3.98, 1.35)</span>
<span class="sd">ftC16st = f_dsp(sigma, 0.2906, 0.8962, 0.1935 )</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">ftC16</span> <span class="o">=</span> <span class="n">f_BH</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="mf">0.28074</span><span class="p">,</span> <span class="mf">0.90343</span><span class="p">,</span> <span class="mf">0.64031</span><span class="p">,</span> <span class="mf">1.69561</span><span class="p">)</span>

<span class="n">ftC16st</span> <span class="o">=</span> <span class="n">f_ST</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="mf">0.31704</span><span class="p">,</span> <span class="mf">0.81869</span><span class="p">,</span> <span class="mf">0.11821</span><span class="p">)</span>
<span class="n">ftC16st_sat</span> <span class="o">=</span> <span class="n">f_ST</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="mf">0.04235</span><span class="p">,</span> <span class="mf">1.70219</span><span class="p">,</span> <span class="mf">0.83118</span><span class="p">)</span>

<span class="n">ftD16</span> <span class="o">=</span> <span class="n">f_ST</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="mf">0.333</span><span class="p">,</span> <span class="mf">0.794</span><span class="p">,</span> <span class="mf">0.247</span> <span class="p">)</span>
<span class="n">ftRP16</span> <span class="o">=</span> <span class="n">f_T08</span> <span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="mf">0.144</span><span class="p">,</span> <span class="mf">1.351</span><span class="p">,</span> <span class="mf">3.113</span><span class="p">,</span> <span class="mf">1.187</span><span class="p">)</span>
<span class="n">ftT08</span> <span class="o">=</span> <span class="n">f_T08</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="mf">0.200</span><span class="p">,</span> <span class="mf">1.47</span><span class="p">,</span> <span class="mf">2.57</span><span class="p">,</span> <span class="mf">1.19</span><span class="p">)</span> <span class="c1"># 300 at z=0</span>
<span class="c1">#ftST01 = f_ST(sigma, 0.3222, 0.707, 0.3)</span>
<span class="n">ftST02</span> <span class="o">=</span> <span class="n">f_ST</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="mf">0.3222</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
<span class="n">ftBH11</span> <span class="o">=</span> <span class="n">f_BH</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="mf">0.333</span><span class="p">,</span> <span class="mf">0.788</span><span class="p">,</span> <span class="mf">0.807</span><span class="p">,</span> <span class="mf">1.795</span><span class="p">)</span>



<span class="c1"># MULTIDARK TABLE GENERIC FUNCTIONS</span>
<span class="n">mSelection</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">,</span> <span class="n">qty</span><span class="p">,</span> <span class="n">logNpmin</span> <span class="p">:</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;log_&quot;</span><span class="o">+</span><span class="n">qty</span><span class="p">]</span><span class="o">&gt;</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;logMpart&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">logNpmin</span><span class="p">)</span>

<span class="n">vSelection</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">,</span> <span class="n">qty</span><span class="p">,</span> <span class="n">limits_04</span><span class="p">,</span> <span class="n">limits_10</span><span class="p">,</span> <span class="n">limits_25</span><span class="p">,</span> <span class="n">limits_40</span> <span class="p">:</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;boxLengthComoving&quot;</span><span class="p">]</span><span class="o">==</span><span class="mf">400.</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">qty</span><span class="o">+</span><span class="s2">&quot;_min&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">limits_04</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">qty</span><span class="o">+</span><span class="s2">&quot;_max&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">limits_04</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">|</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;boxLengthComoving&quot;</span><span class="p">]</span><span class="o">==</span><span class="mf">1000.</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">qty</span><span class="o">+</span><span class="s2">&quot;_min&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">limits_10</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">qty</span><span class="o">+</span><span class="s2">&quot;_max&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">limits_10</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">|</span>  <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;boxLengthComoving&quot;</span><span class="p">]</span><span class="o">==</span><span class="mf">2500.</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">qty</span><span class="o">+</span><span class="s2">&quot;_min&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">limits_25</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">qty</span><span class="o">+</span><span class="s2">&quot;_max&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">limits_25</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">|</span>  <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;boxLengthComoving&quot;</span><span class="p">]</span><span class="o">==</span><span class="mf">4000.</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">qty</span><span class="o">+</span><span class="s2">&quot;_min&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">limits_40</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">qty</span><span class="o">+</span><span class="s2">&quot;_max&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">limits_40</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> 

<span class="n">zSelection</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="p">:</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;redshift&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">zmin</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;redshift&quot;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">zmax</span><span class="p">)</span>

<span class="n">nSelection</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">,</span> <span class="n">NminCount</span><span class="p">,</span> <span class="n">cos</span> <span class="p">:</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dN_counts_&#39;</span><span class="o">+</span><span class="n">cos</span><span class="p">]</span><span class="o">&gt;</span><span class="n">NminCount</span><span class="p">)</span>

<span class="c1"># MVIR 1point FUNCTION </span>

<div class="viewcode-block" id="plot_mvir_function_data"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.plot_mvir_function_data">[docs]</a><span class="k">def</span> <span class="nf">plot_mvir_function_data</span><span class="p">(</span><span class="n">log_mvir</span><span class="p">,</span> <span class="n">logsigM1</span><span class="p">,</span> <span class="n">logNu</span><span class="p">,</span> <span class="n">log_MF</span><span class="p">,</span> <span class="n">log_MF_c</span><span class="p">,</span> <span class="n">redshift</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">cos</span> <span class="o">=</span> <span class="s2">&quot;cen&quot;</span><span class="p">,</span> <span class="n">figName</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MVIR_DIR&#39;</span><span class="p">])):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	:param log_mvir: x coordinates</span>
<span class="sd">	:param log_VF: y coordinates</span>
<span class="sd">	:param redshift: color coordinate</span>
<span class="sd">	:param zmin: minimum redshift</span>
<span class="sd">	:param zmax: maximum redshift</span>
<span class="sd">	:param cos: centra or satelitte. Default: &quot;cen&quot;</span>
<span class="sd">	:param figName: string to be added to the figure name. Default:=&quot;&quot;</span>
<span class="sd">	:param dir: working directory.  :param qty: quantity studied. Default: &#39;mvir&#39;</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># now the plots</span>
	<span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
	<span class="n">sc1</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">logsigM1</span><span class="p">,</span> <span class="n">log_MF</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">redshift</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD &quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot; data&quot;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">zmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">zmax</span><span class="p">)</span>
	<span class="n">sc1</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;face&#39;</span><span class="p">)</span>
	<span class="n">cb</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
	<span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;redshift&quot;</span><span class="p">)</span>
	<span class="n">sigs</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
	<span class="c1">#p.plot(X, n.log10(ftT08), &#39;k--&#39;, label=&#39;T08&#39;, lw=2)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ftC16</span><span class="p">),</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
	<span class="c1">#p.plot(X, n.log10(ftBH11), &#39;g--&#39;, label=&#39;B11&#39;, lw=2)</span>
	<span class="c1">#p.plot(X, n.log10(ftC16), &#39;r--&#39;, label=&#39;this work&#39;, lw=2)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$log_{10}(\sigma^{-1})$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_{10}\left[ \frac{M}{\rho_m} \frac{dn}{d\ln M} \left|\frac{d\ln M }{d\ln \sigma}\right|\right] $&#39;</span><span class="p">)</span> 
	 <span class="c1"># log$_{10}[ n(&gt;M)]&#39;)</span>
	<span class="n">gl</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
	<span class="n">gl</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
	<span class="n">p</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;mvir-&quot;</span><span class="o">+</span><span class="n">figName</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-differential-function-data-xSigma.png&quot;</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
	
	<span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
	<span class="n">sc1</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">logNu</span><span class="p">,</span> <span class="n">log_MF</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">redshift</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD &quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot; data&quot;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">zmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">zmax</span><span class="p">)</span>
	<span class="n">sc1</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;face&#39;</span><span class="p">)</span>
	<span class="n">cb</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
	<span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;redshift&quot;</span><span class="p">)</span>
	<span class="n">nus</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
	<span class="c1">#p.plot(nus, log_fnu_ST_ps(nus, p_ST_despali), &#39;k--&#39;, label=&#39;Despali 16&#39;)</span>
	<span class="c1">#p.plot(nus, log_fnu_ST_ps(nus, p_ST_sheth), &#39;b--&#39;, label=&#39;Sheth 01&#39;)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$ln(\nu)$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_{10}\left[ \frac{M}{\rho_m} \frac{dn}{d\ln M} \left|\frac{d\ln M }{d\ln \sigma}\right|\right] $&#39;</span><span class="p">)</span> 
	 <span class="c1"># log$_{10}[ n(&gt;M)]&#39;)</span>
	<span class="n">gl</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
	<span class="n">gl</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
	<span class="n">p</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;mvir-&quot;</span><span class="o">+</span><span class="n">figName</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-differential-function-data-xNu.png&quot;</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	p.figure(0,(6,6))</span>
<span class="sd">	p.axes([0.17,0.17,0.75,0.75])</span>
<span class="sd">	sc1=p.scatter(log_mvir, log_MF, c=redshift, s=5, marker=&#39;o&#39;,label=&quot;MD &quot;+cos+&quot; data&quot;, rasterized=True, vmin=zmin, vmax = zmax)</span>
<span class="sd">	sc1.set_edgecolor(&#39;face&#39;)</span>
<span class="sd">	cb = p.colorbar(shrink=0.8)</span>
<span class="sd">	cb.set_label(&quot;redshift&quot;)</span>
<span class="sd">	p.xlabel(r&#39;log$_{10}[M_{vir}/(h^{-1}M_\odot)]$&#39;)</span>
<span class="sd">	p.ylabel(r&#39;log$_{10} (M^2/\rho_m) dn(M)/dM$&#39;) </span>
<span class="sd">	 # log$_{10}[ n(&gt;M)]&#39;)</span>
<span class="sd">	gl = p.legend(loc=0,fontsize=10)</span>
<span class="sd">	gl.set_frame_on(False)</span>
<span class="sd">	p.ylim((-4.5,-1))</span>
<span class="sd">	p.xlim((9.5,16))</span>
<span class="sd">	p.grid()</span>
<span class="sd">	p.savefig(join(dir,&quot;mvir-&quot;+figName+cos+&quot;-differential-function-data-xMass.png&quot;))</span>
<span class="sd">	p.clf()</span>
<span class="sd">	</span>
<span class="sd">	p.figure(0,(6,6))</span>
<span class="sd">	p.axes([0.17,0.17,0.75,0.75])</span>
<span class="sd">	sc1=p.scatter(logsigM1, log_MF, c=redshift, s=5, marker=&#39;o&#39;,label=&quot;MD &quot;+cos+&quot; data&quot;, rasterized=True, vmin=zmin, vmax = zmax)</span>
<span class="sd">	sc1.set_edgecolor(&#39;face&#39;)</span>
<span class="sd">	cb = p.colorbar(shrink=0.8)</span>
<span class="sd">	cb.set_label(&quot;redshift&quot;)</span>
<span class="sd">	p.xlabel(r&#39;$ln(\sigma^{-1})$&#39;)</span>
<span class="sd">	p.ylabel(r&#39;log$_{10} (M^2/\rho_m) dn(M)/dM$&#39;) </span>
<span class="sd">	 # log$_{10}[ n(&gt;M)]&#39;)</span>
<span class="sd">	gl = p.legend(loc=0,fontsize=10)</span>
<span class="sd">	gl.set_frame_on(False)</span>
<span class="sd">	p.ylim((-4.5,-1))</span>
<span class="sd">	p.grid()</span>
<span class="sd">	p.savefig(join(dir,&quot;mvir-&quot;+figName+cos+&quot;-differential-function-data-xSigma.png&quot;))</span>
<span class="sd">	p.clf()</span>
<span class="sd">	</span>
<span class="sd">	p.figure(0,(6,6))</span>
<span class="sd">	p.axes([0.17,0.17,0.75,0.75])</span>
<span class="sd">	sc1=p.scatter(log_mvir, log_MF_c, c=redshift, s=5, marker=&#39;o&#39;,label=&quot;MD &quot;+cos+&quot; data&quot;, rasterized=True, vmin=zmin, vmax = zmax)</span>
<span class="sd">	sc1.set_edgecolor(&#39;face&#39;)</span>
<span class="sd">	cb = p.colorbar(shrink=0.8)</span>
<span class="sd">	cb.set_label(&quot;redshift&quot;)</span>
<span class="sd">	p.xlabel(r&#39;log$_{10}[M_{vir}/(h^{-1}M_\odot)]$&#39;)</span>
<span class="sd">	p.ylabel(r&#39;log$_{10} (M^2/\rho_m) n(&gt;M)$&#39;) </span>
<span class="sd">	gl = p.legend(loc=0,fontsize=10)</span>
<span class="sd">	gl.set_frame_on(False)</span>
<span class="sd">	p.ylim((-4.5,-1))</span>
<span class="sd">	p.xlim((9.5,16))</span>
<span class="sd">	p.grid()</span>
<span class="sd">	p.savefig(join(dir,&quot;mvir-&quot;+figName+cos+&quot;-cumulative-function-data-xMass.png&quot;))</span>
<span class="sd">	p.clf()</span>
<span class="sd">	&quot;&quot;&quot;</span></div>
	
<div class="viewcode-block" id="plot_mvir_function_data_perBox"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.plot_mvir_function_data_perBox">[docs]</a><span class="k">def</span> <span class="nf">plot_mvir_function_data_perBox</span><span class="p">(</span><span class="n">log_mvir</span><span class="p">,</span> <span class="n">log_VF</span><span class="p">,</span> <span class="n">MD04</span><span class="p">,</span> <span class="n">MD10</span><span class="p">,</span> <span class="n">MD25</span><span class="p">,</span> <span class="n">MD25NW</span><span class="p">,</span> <span class="n">MD40</span><span class="p">,</span> <span class="n">MD40NW</span><span class="p">,</span> <span class="n">cos</span> <span class="o">=</span> <span class="s2">&quot;cen&quot;</span><span class="p">,</span> <span class="n">figName</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MVIR_DIR&#39;</span><span class="p">])):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	:param log_mvir: x coordinates</span>
<span class="sd">	:param log_VF: y coordinates</span>
<span class="sd">	:param cos: centra or satelitte. Default: &quot;cen&quot;</span>
<span class="sd">	:param figName: string to be added to the figure name. Default:=&quot;&quot;</span>
<span class="sd">	:param dir: working directory.</span>
<span class="sd">	:param qty: quantity studied. Default: &#39;mvir&#39;</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_mvir</span><span class="p">[</span><span class="n">MD04</span><span class="p">],</span> <span class="n">log_VF</span><span class="p">[</span><span class="n">MD04</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD04&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_mvir</span><span class="p">[</span><span class="n">MD10</span><span class="p">],</span> <span class="n">log_VF</span><span class="p">[</span><span class="n">MD10</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD10&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_mvir</span><span class="p">[</span><span class="n">MD25</span><span class="p">],</span> <span class="n">log_VF</span><span class="p">[</span><span class="n">MD25</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD25&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_mvir</span><span class="p">[</span><span class="n">MD40</span><span class="p">],</span> <span class="n">log_VF</span><span class="p">[</span><span class="n">MD40</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD40&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_mvir</span><span class="p">[</span><span class="n">MD25NW</span><span class="p">],</span> <span class="n">log_VF</span><span class="p">[</span><span class="n">MD25NW</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD25NW&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_mvir</span><span class="p">[</span><span class="n">MD40NW</span><span class="p">],</span> <span class="n">log_VF</span><span class="p">[</span><span class="n">MD40NW</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD40NW&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;log$_{10}[M_{vir}/(M_\odot)]$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_{10}\left[ \frac{M}{\rho_m} \frac{dn}{d\ln M} \left|\frac{d\ln M }{d\ln \sigma}\right|\right] $&#39;</span><span class="p">)</span> 
	<span class="n">gl</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
	<span class="n">gl</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mf">9.5</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
	<span class="n">p</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;mvir-&quot;</span><span class="o">+</span><span class="n">figName</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-differential-function-data-perBox.png&quot;</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_mvir_function_jackknife_poisson_error"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.plot_mvir_function_jackknife_poisson_error">[docs]</a><span class="k">def</span> <span class="nf">plot_mvir_function_jackknife_poisson_error</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">MD04</span><span class="p">,</span> <span class="n">MD10</span><span class="p">,</span> <span class="n">MD25</span><span class="p">,</span> <span class="n">MD25NW</span><span class="p">,</span> <span class="n">MD40</span><span class="p">,</span> <span class="n">MD40NW</span><span class="p">,</span> <span class="n">cos</span> <span class="o">=</span> <span class="s2">&quot;cen&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MVIR_DIR&#39;</span><span class="p">])):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	:param x: x coordinates</span>
<span class="sd">	:param y: y coordinates</span>
<span class="sd">	:param cos: centra or satelitte. Default: &quot;cen&quot;</span>
<span class="sd">	:param dir: working directory.  </span>
<span class="sd">	:param qty: quantity studied. Default: &#39;mvir&#39;</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">MD04</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">MD04</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD04&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">MD10</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">MD10</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD10&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">MD25</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">MD25</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD25&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">MD40</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">MD40</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD40&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">MD25NW</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">MD25NW</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD25NW&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">MD40NW</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">MD40NW</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD40NW&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">xx</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">xx</span><span class="o">*</span><span class="mf">3.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y=3x&#39;</span><span class="p">)</span>
	<span class="c1">#p.axhline(Npmin**-0.5, c=&#39;r&#39;, ls=&#39;--&#39;, label=&#39;min counts cut&#39;)#r&#39;$1/\sqrt{10^3}$&#39;)</span>
	<span class="c1">#p.axhline((10**6.87)**-0.5, c=&#39;k&#39;, ls=&#39;--&#39;, label=&#39;min mvir cut&#39;)#r&#39;$1/\sqrt{10^{4.87}}$&#39;)</span>
	<span class="c1">#p.xlim((2e-4,4e-1))</span>
	<span class="c1">#p.ylim((2e-4,4e-1))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$1/\sqrt{count} \; [\%]$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Jackknife  Resampling Error [%]&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
	<span class="n">gl</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
	<span class="n">gl</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
	<span class="n">p</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;mvir-&quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-jackknife-countsSqrt.png&quot;</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span></div>

<div class="viewcode-block" id="plot_mvir_function_data_error"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.plot_mvir_function_data_error">[docs]</a><span class="k">def</span> <span class="nf">plot_mvir_function_data_error</span><span class="p">(</span><span class="n">log_mvir</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">redshift</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">cos</span> <span class="o">=</span> <span class="s2">&quot;cen&quot;</span><span class="p">,</span> <span class="n">figName</span><span class="o">=</span><span class="s2">&quot;mvir-cen-data04-uncertainty.png&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MVIR_DIR&#39;</span><span class="p">])):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	:param log_mvir: x coordinates</span>
<span class="sd">	:param error: y coordinates</span>
<span class="sd">	:param redshift: color coordinate</span>
<span class="sd">	:param label: label in the caption</span>
<span class="sd">	:param zmin: minimum redshift</span>
<span class="sd">	:param zmax: maximum redshift</span>
<span class="sd">	:param cos: centra or satelitte. Default: &quot;cen&quot;</span>
<span class="sd">	:param figName: string to be added to the figure name. Default:=&quot;&quot;</span>
<span class="sd">	:param dir: working directory.  :param qty: quantity studied. Default: &#39;mvir&#39;</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
	<span class="n">sc1</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">log_mvir</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">error</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">redshift</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">zmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">zmax</span><span class="p">)</span>
	<span class="n">sc1</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;face&#39;</span><span class="p">)</span>
	<span class="n">cb</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
	<span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;redshift&quot;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;log$_{10}[V_{max}/(km \; s^{-1})]$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;JK relative error [%]&#39;</span><span class="p">)</span> 
	<span class="n">gl</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
	<span class="n">gl</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mf">2e-2</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span>
	<span class="c1">#p.xlim((1.5, 3.5))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
	<span class="n">p</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="n">figName</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span></div>

<div class="viewcode-block" id="fit_mvir_function_z0"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.fit_mvir_function_z0">[docs]</a><span class="k">def</span> <span class="nf">fit_mvir_function_z0</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span> <span class="p">,</span> <span class="n">y_err</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> 	<span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="n">cos</span> <span class="o">=</span> <span class="s2">&quot;cen&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MVIR_DIR&#39;</span><span class="p">])):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Fits a function to the mvir data</span>
<span class="sd">	:param data: data table of the selected points for the fit</span>
<span class="sd">	:param x_data: x coordinate</span>
<span class="sd">	:param y_data: y coordinate</span>
<span class="sd">	:param y_err: error</span>
<span class="sd">	:param p0: first guess</span>
<span class="sd">	:param tolerance: percentage error tolerance to compute how many points are outside of the fit</span>
<span class="sd">	:param cos: central or satelitte</span>
<span class="sd">	:param mode: fitting mode, &quot;curve_fit&quot; or &quot;minimize&quot;</span>
<span class="sd">	:param dir: working dir</span>
<span class="sd">	:param qty: mvir here</span>
<span class="sd">	:return: result of the fit: best parameter array and covariance matrix</span>
<span class="sd">	produces a plot of the residuals</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">pOpt</span><span class="p">,</span> <span class="n">pCov</span><span class="o">=</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">log_fnu_ST</span><span class="p">,</span> <span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">y_err</span><span class="p">,</span> <span class="n">maxfev</span><span class="o">=</span><span class="mi">500000</span><span class="p">)</span><span class="c1">#, bounds=boundaries)</span>
	<span class="k">print</span> <span class="s2">&quot;best params=&quot;</span><span class="p">,</span> <span class="n">pOpt</span>
	<span class="k">print</span> <span class="s2">&quot;err=&quot;</span><span class="p">,</span> <span class="n">pCov</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span><span class="o">**</span><span class="mf">0.5</span>
		
	<span class="n">x_model</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_data</span><span class="p">),</span><span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_data</span><span class="p">),</span><span class="mf">0.005</span><span class="p">)</span>
	<span class="n">y_model</span> <span class="o">=</span> <span class="n">log_fnu_ST</span><span class="p">(</span><span class="n">x_model</span><span class="p">,</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
	<span class="n">n</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;mvir-&quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-differential-function-z0-model-pts.txt&quot;</span><span class="p">),</span><span class="n">n</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">x_model</span><span class="p">,</span> <span class="n">y_model</span><span class="p">])</span> <span class="p">)</span>
	<span class="n">outfile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;mvir-&quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-diff-function-z0-params.pkl&quot;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
	<span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">([</span><span class="n">pOpt</span><span class="p">,</span> <span class="n">pCov</span><span class="p">],</span> <span class="n">outfile</span><span class="p">)</span>
	<span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			
	<span class="n">f_diff</span> <span class="o">=</span>  <span class="n">y_data</span> <span class="o">-</span> <span class="n">log_fnu_ST</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

	<span class="n">MD_sel_fun</span><span class="o">=</span><span class="k">lambda</span> <span class="n">name</span> <span class="p">:</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;boxName&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">name</span><span class="p">)</span>
	<span class="n">MDnames</span><span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;M04&#39;</span><span class="p">,</span> <span class="s1">&#39;M10&#39;</span><span class="p">,</span> <span class="s1">&#39;M25&#39;</span><span class="p">,</span><span class="s1">&#39;M40&#39;</span><span class="p">,</span><span class="s1">&#39;M25n&#39;</span><span class="p">,</span><span class="s1">&#39;M40n&#39;</span><span class="p">])</span>
	<span class="n">MDsels</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">MD_sel_fun</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">MDnames</span><span class="p">])</span>

	<span class="n">f_diff_fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">MDs</span><span class="p">:</span>  <span class="n">y_data</span><span class="p">[</span><span class="n">MDs</span><span class="p">]</span> <span class="o">-</span> <span class="n">log_fnu_ST</span><span class="p">(</span><span class="n">x_data</span><span class="p">[</span><span class="n">MDs</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
	<span class="n">f_diffs</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f_diff_fun</span><span class="p">(</span><span class="n">MD</span><span class="p">)</span> <span class="k">for</span> <span class="n">MD</span> <span class="ow">in</span> <span class="n">MDsels</span><span class="p">])</span>

	<span class="k">print</span> <span class="s2">&quot;================================&quot;</span>

	<span class="c1"># now the plots</span>
	<span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">fd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f_diffs</span><span class="p">):</span>
		<span class="n">inTol</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">fd</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tolerance</span><span class="p">)</span>
		<span class="k">print</span> <span class="n">index</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="n">p</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x_data</span><span class="p">[</span><span class="n">MDsels</span><span class="p">[</span><span class="n">index</span><span class="p">]],</span> <span class="mi">10</span><span class="o">**</span><span class="n">fd</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">y_err</span><span class="p">[</span><span class="n">MDsels</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span> <span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">MDnames</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
			<span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">inTol</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">fd</span><span class="p">),</span> <span class="mf">100.</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">inTol</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>

	<span class="n">p</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.01</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;syst $\pm1\%$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$log_{10}(\nu)$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;data/model&#39;</span><span class="p">)</span> 
	<span class="n">gl</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
	<span class="n">gl</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
	<span class="c1">#p.xlim((-0.7,0.6))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mf">0.92</span><span class="p">,</span><span class="mf">1.08</span><span class="p">))</span>
	<span class="c1">#p.yscale(&#39;log&#39;)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
	<span class="n">p</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;fit-&quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-differential-function-residual-log.png&quot;</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">pOpt</span><span class="p">,</span> <span class="n">pCov</span></div>

<span class="c1"># VMAX 1point FUNCTION </span>
<div class="viewcode-block" id="plot_jackknife_poisson_error"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.plot_jackknife_poisson_error">[docs]</a><span class="k">def</span> <span class="nf">plot_jackknife_poisson_error</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">MD04</span><span class="p">,</span> <span class="n">MD10</span><span class="p">,</span> <span class="n">MD25</span><span class="p">,</span> <span class="n">MD25NW</span><span class="p">,</span> <span class="n">MD40</span><span class="p">,</span> <span class="n">MD40NW</span><span class="p">,</span> <span class="n">DS80</span><span class="p">,</span> <span class="n">cos</span> <span class="o">=</span> <span class="s2">&quot;cen&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MVIR_DIR&#39;</span><span class="p">])):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	:param x: x coordinates</span>
<span class="sd">	:param y: y coordinates</span>
<span class="sd">	:param cos: centra or satelitte. Default: &quot;cen&quot;</span>
<span class="sd">	:param dir: working directory.  :param qty: quantity studied. Default: &#39;vmax&#39;</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;k,&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">MD04</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">MD04</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD04&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">MD10</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">MD10</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD10&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">MD25</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">MD25</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD25&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">MD40</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">MD40</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD40&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">MD25NW</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">MD25NW</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD25NW&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">MD40NW</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">MD40NW</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD40NW&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">DS80</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">DS80</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;DS80&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">xx</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">xx</span><span class="o">*</span><span class="mf">3.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y=3x&#39;</span><span class="p">)</span>
	<span class="c1">#p.axhline(Npmin**-0.5, c=&#39;r&#39;, ls=&#39;--&#39;, label=&#39;min counts cut&#39;)#r&#39;$1/\sqrt{10^3}$&#39;)</span>
	<span class="c1">#p.axhline((10**6.87)**-0.5, c=&#39;k&#39;, ls=&#39;--&#39;, label=&#39;min vmax cut&#39;)#r&#39;$1/\sqrt{10^{4.87}}$&#39;)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mf">1e-4</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mf">1e-4</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$1/\sqrt{count} \; [\%]$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Jackknife  Resampling Error [%]&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
	<span class="n">gl</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
	<span class="n">gl</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
	<span class="n">p</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;jackknife-countsSqrt-&quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span></div>


<div class="viewcode-block" id="fit_mvir_function_zTrend"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.fit_mvir_function_zTrend">[docs]</a><span class="k">def</span> <span class="nf">fit_mvir_function_zTrend</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">z_data</span> <span class="p">,</span> <span class="n">y_err</span><span class="p">,</span> <span class="n">ps0</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> 	<span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="n">cos</span> <span class="o">=</span> <span class="s2">&quot;cen&quot;</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;curve_fit&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MVIR_DIR&#39;</span><span class="p">]),</span> <span class="n">zmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="mf">2.5</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Fits a function to the mvir data</span>
<span class="sd">	:param data: data table of the selected points for the fit</span>
<span class="sd">	:param x_data: x coordinate</span>
<span class="sd">	:param y_data: y coordinate</span>
<span class="sd">	:param z_data: redshift coordinate</span>
<span class="sd">	:param y_err: error</span>
<span class="sd">	:param ps0: first guess</span>
<span class="sd">	:param tolerance: percentage error tolerance to compute how many points are outside of the fit</span>
<span class="sd">	:param cos: central or satelitte</span>
<span class="sd">	:param mode: fitting mode, &quot;curve_fit&quot; or &quot;minimize&quot;</span>
<span class="sd">	:param dir: working dir</span>
<span class="sd">	:param qty: mvir here</span>
<span class="sd">	:return: result of the fit: best parameter array and covariance matrix</span>
<span class="sd">	produces a plot of the residuals</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">outfile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;mvir-&quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-diff-function-z0-params.pkl&quot;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
	<span class="n">pOpt</span><span class="p">,</span> <span class="n">pCov</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
	<span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="n">A0</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">p0</span> <span class="o">=</span> <span class="n">pOpt</span>
	
	<span class="n">Az</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">,</span> <span class="n">A1</span> <span class="p">:</span> <span class="n">A0</span><span class="o">+</span><span class="n">z</span><span class="o">*</span><span class="n">A1</span>
	<span class="n">az</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">,</span> <span class="n">a1</span> <span class="p">:</span> <span class="n">a0</span><span class="o">+</span><span class="n">z</span><span class="o">*</span><span class="n">a1</span>
	<span class="n">pz</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">,</span> <span class="n">p1</span> <span class="p">:</span> <span class="n">p0</span><span class="o">+</span><span class="n">z</span><span class="o">*</span><span class="n">p1</span>
	<span class="n">delta_c</span><span class="o">=</span><span class="mf">1.686</span>
	<span class="n">Anorm0</span><span class="o">=</span><span class="mf">0.333</span>
	<span class="n">fnu_SMT</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">nu</span><span class="p">,</span> <span class="n">Anorm</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">q</span> <span class="p">:</span> <span class="n">Anorm</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.</span><span class="o">/</span><span class="n">n</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">nu</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">nu</span><span class="p">)</span> <span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">q</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">e</span><span class="o">**</span><span class="p">(</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">nu</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span> 
	<span class="n">log_fnu_ST01</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">logNu</span><span class="p">,</span> <span class="n">Anorm</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">q</span> <span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="n">fnu_SMT</span><span class="p">(</span><span class="mf">10.</span><span class="o">**</span><span class="n">logNu</span><span class="p">,</span> <span class="n">Anorm</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="p">)</span>
	<span class="n">log_fnu_ST01_ps</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">logSigma</span><span class="p">,</span> <span class="n">ps</span> <span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="n">fnu_SMT</span><span class="p">(</span><span class="mf">10.</span><span class="o">**</span><span class="n">logNu</span><span class="p">,</span> <span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">)</span>
	
	<span class="n">f_SMT_z</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">p1</span><span class="p">:</span> <span class="n">Az</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">A1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">az</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">((</span><span class="n">delta_c</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="o">/</span><span class="n">az</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">a1</span><span class="p">))</span> <span class="o">**</span><span class="p">(</span><span class="n">pz</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">p1</span><span class="p">))</span> <span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">e</span><span class="o">**</span><span class="p">(</span> <span class="o">-</span> <span class="n">az</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">delta_c</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">delta_c</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span>

	<span class="n">log_f_ST01_zt_ps</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">logSigma</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">ps</span> <span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="n">f_SMT_z</span><span class="p">(</span><span class="mf">10.</span><span class="o">**</span><span class="n">logSigma</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ps</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">)</span>

	<span class="k">print</span> <span class="s2">&quot;mode: minimize&quot;</span>
	<span class="n">chi2fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ps</span> <span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">log_f_ST01_zt_ps</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">z_data</span><span class="p">,</span> <span class="n">ps</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_data</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_err</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span> <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">ps0</span><span class="p">))</span>
	<span class="n">res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">chi2fun</span><span class="p">,</span> <span class="n">ps0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Powell&#39;</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xtol&#39;</span><span class="p">:</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s1">&#39;maxiter&#39;</span> <span class="p">:</span> <span class="mi">5000000000000</span><span class="p">})</span>
	<span class="n">pOpt</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>
	<span class="n">pCov</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">direc</span>
	<span class="k">print</span> <span class="s2">&quot;best params=&quot;</span><span class="p">,</span><span class="n">pOpt</span>
	<span class="k">print</span> <span class="s2">&quot;err=&quot;</span><span class="p">,</span><span class="n">pCov</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span><span class="o">**</span><span class="mf">0.5</span> 
		
	<span class="c1">#x_model = n.arange(n.min(x_data),n.max(x_data),0.005)</span>
	<span class="c1">#y_model = log_f_ST01_zt_ps(x_model, pOpt)</span>
	<span class="c1">#n.savetxt(join(dir,&quot;mvir-&quot;+cos+&quot;-differential-function-zTrend-model-pts.txt&quot;),n.transpose([x_model, y_model]) )</span>
	<span class="n">outfile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;mvir-&quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-diff-function-zTrend-params.pkl&quot;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
	<span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">([</span><span class="n">pOpt</span><span class="p">,</span> <span class="n">pCov</span><span class="p">],</span> <span class="n">outfile</span><span class="p">)</span>
	<span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			
	<span class="n">f_diff</span> <span class="o">=</span>  <span class="n">y_data</span> <span class="o">-</span> <span class="n">log_f_ST01_zt_ps</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">z_data</span><span class="p">,</span> <span class="n">pOpt</span><span class="p">)</span>
	
	<span class="n">MD_sel_fun</span><span class="o">=</span><span class="k">lambda</span> <span class="n">name</span> <span class="p">:</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;boxName&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">name</span><span class="p">)</span>
	<span class="n">MDnames</span><span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;M04&#39;</span><span class="p">,</span> <span class="s1">&#39;M10&#39;</span><span class="p">,</span> <span class="s1">&#39;M25&#39;</span><span class="p">,</span><span class="s1">&#39;M40&#39;</span><span class="p">,</span><span class="s1">&#39;M25n&#39;</span><span class="p">,</span><span class="s1">&#39;M40n&#39;</span><span class="p">])</span>
	<span class="n">MDsels</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">MD_sel_fun</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">MDnames</span><span class="p">])</span>
	
	<span class="n">f_diff_fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">MDs</span><span class="p">:</span>  <span class="n">y_data</span><span class="p">[</span><span class="n">MDs</span><span class="p">]</span> <span class="o">-</span> <span class="n">log_f_ST01_zt_ps</span><span class="p">(</span><span class="n">x_data</span><span class="p">[</span><span class="n">MDs</span><span class="p">],</span> <span class="n">z_data</span><span class="p">[</span><span class="n">MDs</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">)</span>
	<span class="n">f_diffs</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f_diff_fun</span><span class="p">(</span><span class="n">MD</span><span class="p">)</span> <span class="k">for</span> <span class="n">MD</span> <span class="ow">in</span> <span class="n">MDsels</span><span class="p">])</span>
	
	<span class="k">print</span> <span class="s2">&quot;================================&quot;</span>
	
	<span class="c1"># now the plots</span>
	<span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">fd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f_diffs</span><span class="p">):</span>
		<span class="n">inTol</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">fd</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tolerance</span><span class="p">)</span>
		<span class="k">print</span> <span class="n">index</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="n">p</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x_data</span><span class="p">[</span><span class="n">MDsels</span><span class="p">[</span><span class="n">index</span><span class="p">]],</span> <span class="mi">10</span><span class="o">**</span><span class="n">fd</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">y_err</span><span class="p">[</span><span class="n">MDsels</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span> <span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">MDnames</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
			<span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">inTol</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">fd</span><span class="p">),</span> <span class="mf">100.</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">inTol</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>

	<span class="n">p</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.01</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;syst $\pm1\%$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$log_{10}(\sigma)$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;data/model&#39;</span><span class="p">)</span> 
	<span class="n">gl</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
	<span class="n">gl</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
	<span class="c1">#p.xlim((-0.7,0.6))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">1.1</span><span class="p">))</span>
	<span class="c1">#p.yscale(&#39;log&#39;)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
	<span class="n">p</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;mvir-&quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-differential-function-fit-ztrend-residual-log.png&quot;</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
	<span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
	<span class="n">sc1</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">log_f_ST01_zt_ps</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">z_data</span><span class="p">,</span> <span class="n">pOpt</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="n">z_data</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD &quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot; model&quot;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">zmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">zmax</span><span class="p">)</span>
	<span class="n">sc1</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;face&#39;</span><span class="p">)</span>
	<span class="n">cb</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
	<span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;redshift&quot;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$log_{10}(\sigma)$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;model Mvir Function&#39;</span><span class="p">)</span> 
	<span class="n">gl</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
	<span class="n">gl</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
	<span class="n">p</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;mvir-&quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-differential-function-fit-ztrend-model.png&quot;</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">pOpt</span><span class="p">,</span> <span class="n">pCov</span></div>

<div class="viewcode-block" id="plot_vmax_function_data_error"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.plot_vmax_function_data_error">[docs]</a><span class="k">def</span> <span class="nf">plot_vmax_function_data_error</span><span class="p">(</span><span class="n">log_vmax</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">redshift</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">cos</span> <span class="o">=</span> <span class="s2">&quot;cen&quot;</span><span class="p">,</span> <span class="n">figName</span><span class="o">=</span><span class="s2">&quot;vmax-cen-data04-uncertainty.png&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;VMAX_DIR&#39;</span><span class="p">])):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	:param log_vmax: x coordinates</span>
<span class="sd">	:param error: y coordinates</span>
<span class="sd">	:param redshift: color coordinate</span>
<span class="sd">	:param label: label in the caption</span>
<span class="sd">	:param zmin: minimum redshift</span>
<span class="sd">	:param zmax: maximum redshift</span>
<span class="sd">	:param cos: centra or satelitte. Default: &quot;cen&quot;</span>
<span class="sd">	:param figName: string to be added to the figure name. Default:=&quot;&quot;</span>
<span class="sd">	:param dir: working directory.  :param qty: quantity studied. Default: &#39;vmax&#39;</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
	<span class="n">sc1</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">log_vmax</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">error</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">redshift</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">zmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">zmax</span><span class="p">)</span>
	<span class="n">sc1</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;face&#39;</span><span class="p">)</span>
	<span class="n">cb</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
	<span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;redshift&quot;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;log$_{10}[V_{max}/(km \; s^{-1})]$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;JK relative error [%]&#39;</span><span class="p">)</span> 
	<span class="n">gl</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
	<span class="n">gl</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mf">2e-2</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span>
	<span class="c1">#p.xlim((1.5, 3.5))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
	<span class="n">p</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="n">figName</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span></div>

<div class="viewcode-block" id="plot_vmax_function_data"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.plot_vmax_function_data">[docs]</a><span class="k">def</span> <span class="nf">plot_vmax_function_data</span><span class="p">(</span><span class="n">log_vmax</span><span class="p">,</span> <span class="n">log_VF</span><span class="p">,</span> <span class="n">log_VF_c</span><span class="p">,</span> <span class="n">redshift</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">cos</span> <span class="o">=</span> <span class="s2">&quot;cen&quot;</span><span class="p">,</span> <span class="n">figName</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;VMAX_DIR&#39;</span><span class="p">])):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	:param log_vmax: x coordinates</span>
<span class="sd">	:param log_VF: y coordinates</span>
<span class="sd">	:param redshift: color coordinate</span>
<span class="sd">	:param zmin: minimum redshift</span>
<span class="sd">	:param zmax: maximum redshift</span>
<span class="sd">	:param cos: centra or satelitte. Default: &quot;cen&quot;</span>
<span class="sd">	:param figName: string to be added to the figure name. Default:=&quot;&quot;</span>
<span class="sd">	:param dir: working directory.  :param qty: quantity studied. Default: &#39;vmax&#39;</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># now the plots</span>
	<span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
	<span class="n">sc1</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">log_vmax</span><span class="p">,</span> <span class="n">log_VF</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">redshift</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD &quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot; data&quot;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">zmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">zmax</span><span class="p">)</span>
	<span class="n">sc1</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;face&#39;</span><span class="p">)</span>
	<span class="n">cb</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
	<span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;redshift&quot;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;log$_{10}[V_{max}/(km \; s^{-1})]$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;log$_{10} [V^3/H^3(z)\; dn(V)/dlnV]$&#39;</span><span class="p">)</span> <span class="c1"># log$_{10}[ n(&gt;M)]&#39;)</span>
	<span class="n">gl</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
	<span class="n">gl</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="mf">5.5</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
	<span class="c1">#p.xlim((1.5, 3.5))</span>
	<span class="c1">#p.ylim((-3.5,-1))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
	<span class="n">p</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;vmax-&quot;</span><span class="o">+</span><span class="n">figName</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-differential-function-data.png&quot;</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
	
	<span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
	<span class="n">sc1</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">log_vmax</span><span class="p">,</span> <span class="n">log_VF_c</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">redshift</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD &quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot; data&quot;</span><span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">zmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">zmax</span><span class="p">)</span>
	<span class="n">sc1</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;face&#39;</span><span class="p">)</span>
	<span class="n">cb</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
	<span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;redshift&quot;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;log$_{10}[V_{max}/(km \; s^{-1})]$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;log$_{10} [V^3/H^3(z)\; n(&gt;V)]$&#39;</span><span class="p">)</span> <span class="c1"># log$_{10}[ n(&gt;M)]&#39;)</span>
	<span class="n">gl</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
	<span class="n">gl</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
	<span class="c1">#p.ylim((-8,1))</span>
	<span class="c1">#p.xlim((1.5, 3.5))</span>
	<span class="c1">#p.yscale(&#39;log&#39;)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
	<span class="n">p</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;vmax-&quot;</span><span class="o">+</span><span class="n">figName</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-cumulative-function-data.png&quot;</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span></div>

<div class="viewcode-block" id="plot_vmax_function_data_perBox"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.plot_vmax_function_data_perBox">[docs]</a><span class="k">def</span> <span class="nf">plot_vmax_function_data_perBox</span><span class="p">(</span><span class="n">log_vmax</span><span class="p">,</span> <span class="n">log_VF</span><span class="p">,</span> <span class="n">log_VF_c</span><span class="p">,</span> <span class="n">MD04</span><span class="p">,</span> <span class="n">MD10</span><span class="p">,</span> <span class="n">MD25</span><span class="p">,</span> <span class="n">MD25NW</span><span class="p">,</span> <span class="n">MD40</span><span class="p">,</span> <span class="n">MD40NW</span><span class="p">,</span> <span class="n">cos</span> <span class="o">=</span> <span class="s2">&quot;cen&quot;</span><span class="p">,</span> <span class="n">figName</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;VMAX_DIR&#39;</span><span class="p">])):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	:param log_vmax: x coordinates</span>
<span class="sd">	:param log_VF: y coordinates</span>
<span class="sd">	:param cos: centra or satelitte. Default: &quot;cen&quot;</span>
<span class="sd">	:param figName: string to be added to the figure name. Default:=&quot;&quot;</span>
<span class="sd">	:param dir: working directory.  :param qty: quantity studied. Default: &#39;vmax&#39;</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># now the plots</span>
	<span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_vmax</span><span class="p">[</span><span class="n">MD04</span><span class="p">],</span> <span class="n">log_VF</span><span class="p">[</span><span class="n">MD04</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD04&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_vmax</span><span class="p">[</span><span class="n">MD10</span><span class="p">],</span> <span class="n">log_VF</span><span class="p">[</span><span class="n">MD10</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD10&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_vmax</span><span class="p">[</span><span class="n">MD25</span><span class="p">],</span> <span class="n">log_VF</span><span class="p">[</span><span class="n">MD25</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD25&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_vmax</span><span class="p">[</span><span class="n">MD40</span><span class="p">],</span> <span class="n">log_VF</span><span class="p">[</span><span class="n">MD40</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD40&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_vmax</span><span class="p">[</span><span class="n">MD25NW</span><span class="p">],</span> <span class="n">log_VF</span><span class="p">[</span><span class="n">MD25NW</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD25NW&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_vmax</span><span class="p">[</span><span class="n">MD40NW</span><span class="p">],</span> <span class="n">log_VF</span><span class="p">[</span><span class="n">MD40NW</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MD40NW&quot;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;log$_{10}[V_{max}/(km \; s^{-1})]$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;log$_{10} [(V^3/H^3(z)\; dn(V)/dlnV]$&#39;</span><span class="p">)</span> <span class="c1"># log$_{10}[ n(&gt;M)]&#39;)</span>
	<span class="n">gl</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
	<span class="n">gl</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
	<span class="c1">#p.ylim((-8,1))</span>
	<span class="c1">#p.xlim((1.5, 3.5))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="mf">5.5</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
	<span class="n">p</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;vmax-&quot;</span><span class="o">+</span><span class="n">figName</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-differential-function-data-perBox.png&quot;</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span></div>

<div class="viewcode-block" id="fit_vmax_function_z0"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.fit_vmax_function_z0">[docs]</a><span class="k">def</span> <span class="nf">fit_vmax_function_z0</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span> <span class="p">,</span> <span class="n">y_err</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> 	<span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span> <span class="n">cos</span> <span class="o">=</span> <span class="s2">&quot;cen&quot;</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;curve_fit&quot;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;VMAX_DIR&#39;</span><span class="p">]),</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Fits a function to the vmax data</span>
<span class="sd">	:param data: data table of the selected points for the fit</span>
<span class="sd">	:param x_data: x coordinate</span>
<span class="sd">	:param y_data: y coordinate</span>
<span class="sd">	:param y_err: error</span>
<span class="sd">	:param p0: first guess</span>
<span class="sd">	:param tolerance: percentage error tolerance to compute how many points are outside of the fit</span>
<span class="sd">	:param cos: central or satelitte</span>
<span class="sd">	:param mode: fitting mode, &quot;curve_fit&quot; or &quot;minimize&quot;</span>
<span class="sd">	:param dir: working dir</span>
<span class="sd">	:param qty: vmax here</span>
<span class="sd">	:return: result of the fit: best parameter array and covariance matrix</span>
<span class="sd">	produces a plot of the residuals</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">chi2fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">ps</span> <span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">vf_ps</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">ps</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_data</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_err</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span> <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">))</span>
	<span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;curve_fit&quot;</span><span class="p">:</span>
		<span class="k">print</span> <span class="s2">&quot;mode: curve_fit&quot;</span>
		<span class="n">pOpt</span><span class="p">,</span> <span class="n">pCov</span><span class="o">=</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">vf</span><span class="p">,</span> <span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">y_err</span><span class="p">,</span> <span class="n">maxfev</span><span class="o">=</span><span class="mi">500000000</span><span class="p">)</span><span class="c1">#, bounds=boundaries)</span>
		<span class="k">print</span> <span class="s2">&quot;best params=&quot;</span><span class="p">,</span><span class="n">pOpt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
		<span class="k">print</span> <span class="s2">&quot;err=&quot;</span><span class="p">,</span><span class="n">pCov</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">pCov</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">pCov</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">pCov</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span>
		<span class="k">print</span> <span class="s2">&quot;Rchi2, ndof, chi2&quot;</span><span class="p">,</span> <span class="n">chi2fun</span><span class="p">(</span><span class="n">pOpt</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">pOpt</span><span class="p">),</span> <span class="n">chi2fun</span><span class="p">(</span><span class="n">pOpt</span><span class="p">)</span><span class="o">*</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">pOpt</span><span class="p">)</span> <span class="p">)</span> 
		
	<span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;minimize&quot;</span><span class="p">:</span>
		<span class="k">print</span> <span class="s2">&quot;mode: minimize&quot;</span>
		<span class="n">res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">chi2fun</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Powell&#39;</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xtol&#39;</span><span class="p">:</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s1">&#39;maxiter&#39;</span> <span class="p">:</span> <span class="mi">5000000000000</span><span class="p">})</span>
		<span class="n">pOpt</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>
		<span class="n">pCov</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">direc</span>
		<span class="k">print</span> <span class="s2">&quot;best params=&quot;</span><span class="p">,</span><span class="n">pOpt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
		<span class="k">print</span> <span class="s2">&quot;err=&quot;</span><span class="p">,</span><span class="n">pCov</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">pCov</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">pCov</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">pCov</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span>
		<span class="k">print</span> <span class="s2">&quot;Rchi2, ndof, chi2&quot;</span><span class="p">,</span> <span class="n">chi2fun</span><span class="p">(</span><span class="n">pOpt</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">pOpt</span><span class="p">),</span> <span class="n">chi2fun</span><span class="p">(</span><span class="n">pOpt</span><span class="p">)</span><span class="o">*</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">pOpt</span><span class="p">)</span> <span class="p">)</span> 
		
	<span class="n">x_model</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x_data</span><span class="p">),</span><span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x_data</span><span class="p">),</span><span class="mf">0.005</span><span class="p">)</span>
	<span class="n">y_model</span> <span class="o">=</span> <span class="n">vf</span><span class="p">(</span><span class="n">x_model</span><span class="p">,</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
	<span class="n">n</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;vmax-&quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-differential-function-z0-model-pts.txt&quot;</span><span class="p">),</span><span class="n">n</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">x_model</span><span class="p">,</span> <span class="n">y_model</span><span class="p">])</span> <span class="p">)</span>
	<span class="n">outfile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;vmax-&quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-diff-function-params-&quot;</span><span class="o">+</span><span class="n">suffix</span><span class="o">+</span><span class="s2">&quot;.pkl&quot;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
	<span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">([</span><span class="n">pOpt</span><span class="p">,</span> <span class="n">pCov</span><span class="p">],</span> <span class="n">outfile</span><span class="p">)</span>
	<span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			
	<span class="n">f_diff</span> <span class="o">=</span>  <span class="n">y_data</span> <span class="o">-</span> <span class="n">vf</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
	
	<span class="n">MD_sel_fun</span><span class="o">=</span><span class="k">lambda</span> <span class="n">name</span> <span class="p">:</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;boxName&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">name</span><span class="p">)</span>
	<span class="n">MDnames</span><span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;M04&#39;</span><span class="p">,</span> <span class="s1">&#39;M10&#39;</span><span class="p">,</span> <span class="s1">&#39;M25&#39;</span><span class="p">,</span><span class="s1">&#39;M40&#39;</span><span class="p">,</span><span class="s1">&#39;M25n&#39;</span><span class="p">,</span><span class="s1">&#39;M40n&#39;</span><span class="p">])</span>
	<span class="n">MDsels</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">MD_sel_fun</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">MDnames</span><span class="p">])</span>
	
	<span class="n">f_diff_fun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">MDs</span><span class="p">:</span>  <span class="n">y_data</span><span class="p">[</span><span class="n">MDs</span><span class="p">]</span> <span class="o">-</span> <span class="n">vf</span><span class="p">(</span><span class="n">x_data</span><span class="p">[</span><span class="n">MDs</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pOpt</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
	<span class="n">f_diffs</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f_diff_fun</span><span class="p">(</span><span class="n">MD</span><span class="p">)</span> <span class="k">for</span> <span class="n">MD</span> <span class="ow">in</span> <span class="n">MDsels</span><span class="p">])</span>
	
	<span class="k">print</span> <span class="s2">&quot;================================&quot;</span>
	
	<span class="c1"># now the plots</span>
	<span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.75</span><span class="p">])</span>
	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">fd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f_diffs</span><span class="p">):</span>
		<span class="n">inTol</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">fd</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tolerance</span><span class="p">)</span>
		<span class="k">print</span> <span class="n">index</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="n">p</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x_data</span><span class="p">[</span><span class="n">MDsels</span><span class="p">[</span><span class="n">index</span><span class="p">]],</span> <span class="mi">10</span><span class="o">**</span><span class="n">fd</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">y_err</span><span class="p">[</span><span class="n">MDsels</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span> <span class="p">,</span> <span class="n">rasterized</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">MDnames</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
			<span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">inTol</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">fd</span><span class="p">),</span> <span class="mf">100.</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">inTol</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>

	<span class="n">p</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.01</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;syst $\pm1\%$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$log(V_{max})$&#39;</span><span class="p">)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;data/model&#39;</span><span class="p">)</span> 
	<span class="n">gl</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
	<span class="n">gl</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
	<span class="c1">#p.xlim((-0.7,0.6))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.2</span><span class="p">))</span>
	<span class="c1">#p.yscale(&#39;log&#39;)</span>
	<span class="n">p</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
	<span class="n">p</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="s2">&quot;vmax-&quot;</span><span class="o">+</span><span class="n">cos</span><span class="o">+</span><span class="s2">&quot;-differential-function-fit-residual-log.png&quot;</span><span class="p">))</span>
	<span class="n">p</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">pOpt</span><span class="p">,</span> <span class="n">pCov</span></div>

<span class="c1"># MULTIDARK DATA OUTPUT HANDLING</span>
<div class="viewcode-block" id="getStat"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.getStat">[docs]</a><span class="k">def</span> <span class="nf">getStat</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span><span class="n">volume</span><span class="p">,</span><span class="n">unitVolume</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	From the pickle file output by the Multidark class, we output the number counts (differential and cumulative) per unit volume per mass bin.</span>
<span class="sd">	:param file: filename</span>
<span class="sd">	:param volume: total volume of the box</span>
<span class="sd">	:param unitVolume: sub volume used in the jackknife</span>
<span class="sd">	:return: Number counts, cumulative number counts, count density, cumulative count density, jackknife mean, jackknife std, cumulative jackknife mean, cumulative jackknife std</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># print file</span>
	<span class="n">data</span><span class="o">=</span><span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">))</span>
	<span class="n">data_c</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="n">ii</span><span class="p">:])</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="p">))</span> <span class="p">])</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
	<span class="n">Ncounts</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
	<span class="n">Ncounts_c</span> <span class="o">=</span> <span class="n">data_c</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># n.array([ n.sum(Ncounts[ii:]) for ii in range(len(Ncounts)) ])</span>
	<span class="n">Nall</span> <span class="o">=</span> <span class="n">Ncounts</span> <span class="o">/</span> <span class="n">volume</span>
	<span class="n">Nall_c</span> <span class="o">=</span> <span class="n">Ncounts_c</span> <span class="o">/</span> <span class="n">volume</span>
	<span class="n">index</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
	<span class="n">n</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span> <span class="n">index</span> <span class="p">)</span>
	<span class="n">Ntotal</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
	<span class="c1"># discard 100</span>
	<span class="k">def</span> <span class="nf">get_mean_std</span><span class="p">(</span> <span class="n">pcDiscard</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		retrieves the mean and std from the jackknife</span>
<span class="sd">		:param pcDiscard:percentage to discard for the jackknife</span>
<span class="sd">		:return: mean, std, cumulative mean90 and cumulative std</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">Ndiscard</span> <span class="o">=</span> <span class="n">Ntotal</span> <span class="o">*</span> <span class="n">pcDiscard</span>
		<span class="n">resamp</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Ntotal</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">Ndiscard</span><span class="p">)</span>
		<span class="n">N90</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Ntotal</span><span class="p">),</span> <span class="n">index</span><span class="p">[</span><span class="n">resamp</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">resamp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]])],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resamp</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span> <span class="o">/</span> <span class="p">(</span><span class="n">unitVolume</span><span class="o">*</span><span class="p">(</span><span class="n">Ntotal</span> <span class="o">-</span> <span class="n">Ndiscard</span><span class="p">)</span> <span class="p">)</span>
		<span class="n">mean90</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">N90</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">std90</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">N90</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">mean90</span>
		<span class="n">N90_c</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data_c</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Ntotal</span><span class="p">),</span> <span class="n">index</span><span class="p">[</span><span class="n">resamp</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">resamp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]])],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resamp</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span> <span class="o">/</span> <span class="p">(</span><span class="n">unitVolume</span><span class="o">*</span><span class="p">(</span><span class="n">Ntotal</span> <span class="o">-</span> <span class="n">Ndiscard</span><span class="p">)</span> <span class="p">)</span>
		<span class="n">mean90_c</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">N90_c</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">std90_c</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">N90_c</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">mean90_c</span>
		<span class="k">return</span> <span class="n">mean90</span><span class="p">,</span> <span class="n">std90</span><span class="p">,</span> <span class="n">mean90_c</span><span class="p">,</span> <span class="n">std90_c</span>

	<span class="n">mean90</span><span class="p">,</span> <span class="n">std90</span><span class="p">,</span> <span class="n">mean90_c</span><span class="p">,</span> <span class="n">std90_c</span> <span class="o">=</span> <span class="n">get_mean_std</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
	<span class="c1">#mean99, std99, mean99_c, std99_c = getMS(0.01)</span>
	<span class="c1">#sel = Nall&gt;1/volume</span>
	<span class="c1">#print std99[sel]/std90[sel]</span>
	<span class="c1">#print mean90[sel]/mean99[sel]</span>
	<span class="c1">#print Nall[sel]/mean99[sel]</span>
	<span class="c1">#print Nall[sel]/mean90[sel]</span>
	<span class="k">return</span> <span class="n">Ncounts</span><span class="p">,</span> <span class="n">Ncounts_c</span><span class="p">,</span> <span class="n">Nall</span><span class="p">,</span> <span class="n">Nall_c</span><span class="p">,</span> <span class="n">mean90</span><span class="p">,</span> <span class="n">std90</span><span class="p">,</span> <span class="n">mean90_c</span><span class="p">,</span> <span class="n">std90_c</span></div>
	
<div class="viewcode-block" id="get_hf"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.get_hf">[docs]</a><span class="k">def</span> <span class="nf">get_hf</span><span class="p">(</span><span class="n">sigma_val</span><span class="o">=</span><span class="mf">0.8228</span><span class="p">,</span> <span class="n">boxRedshift</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Halo mass function model for the MultiDark simulation.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1">#hf0 = MassFunction(cosmo_model=cosmo, sigma_8=sigma_val, z=boxRedshift)</span>
	<span class="n">omega</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">zz</span><span class="p">:</span> <span class="n">cosmoMD</span><span class="o">.</span><span class="n">Om0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">zz</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span> <span class="o">/</span> <span class="n">cosmoMD</span><span class="o">.</span><span class="n">efunc</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
	<span class="n">DeltaVir_bn98</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">zz</span> <span class="p">:</span> <span class="p">(</span><span class="mf">18.</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mf">2.</span> <span class="o">+</span> <span class="mf">82.</span><span class="o">*</span><span class="p">(</span><span class="n">omega</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span> <span class="mf">39.</span><span class="o">*</span><span class="p">(</span><span class="n">omega</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="n">omega</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span>
	<span class="k">print</span> <span class="s2">&quot;DeltaVir&quot;</span><span class="p">,</span> <span class="n">DeltaVir_bn98</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">),</span> <span class="s2">&quot; at z&quot;</span><span class="p">,</span><span class="n">boxRedshift</span>
	<span class="n">hf1</span> <span class="o">=</span> <span class="n">MassFunction</span><span class="p">(</span><span class="n">cosmo_model</span><span class="o">=</span><span class="n">cosmoMD</span><span class="p">,</span> <span class="n">sigma_8</span><span class="o">=</span><span class="n">sigma_val</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">boxRedshift</span><span class="p">,</span> <span class="n">delta_h</span><span class="o">=</span><span class="n">DeltaVir_bn98</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">),</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="n">delta_wrt</span><span class="p">,</span> <span class="n">Mmin</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">Mmax</span><span class="o">=</span><span class="mf">16.5</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">hf1</span></div>

<div class="viewcode-block" id="get_hf_ds"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.get_hf_ds">[docs]</a><span class="k">def</span> <span class="nf">get_hf_ds</span><span class="p">(</span><span class="n">sigma_val</span><span class="o">=</span><span class="mf">0.8355</span><span class="p">,</span> <span class="n">boxRedshift</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Halo mass function model for the Darkskies simulation.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1">#hf0 = MassFunction(cosmo_model=cosmo, sigma_8=sigma_val, z=boxRedshift)</span>
	<span class="n">omega</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">zz</span><span class="p">:</span> <span class="n">cosmoDS</span><span class="o">.</span><span class="n">Om0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">zz</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span> <span class="o">/</span> <span class="n">cosmoDS</span><span class="o">.</span><span class="n">efunc</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
	<span class="n">DeltaVir_bn98</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">zz</span> <span class="p">:</span> <span class="p">(</span><span class="mf">18.</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mf">2.</span> <span class="o">+</span> <span class="mf">82.</span><span class="o">*</span><span class="p">(</span><span class="n">omega</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span> <span class="mf">39.</span><span class="o">*</span><span class="p">(</span><span class="n">omega</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="n">omega</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span>
	<span class="k">print</span> <span class="s2">&quot;DeltaVir&quot;</span><span class="p">,</span> <span class="n">DeltaVir_bn98</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">),</span> <span class="s2">&quot; at z&quot;</span><span class="p">,</span><span class="n">boxRedshift</span>
	<span class="n">hf1</span> <span class="o">=</span> <span class="n">MassFunction</span><span class="p">(</span><span class="n">cosmo_model</span><span class="o">=</span><span class="n">cosmoDS</span><span class="p">,</span> <span class="n">sigma_8</span><span class="o">=</span><span class="n">sigma_val</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">boxRedshift</span><span class="p">,</span> <span class="n">delta_h</span><span class="o">=</span><span class="n">DeltaVir_bn98</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">),</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="n">delta_wrt</span><span class="p">,</span> <span class="n">Mmin</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">Mmax</span><span class="o">=</span><span class="mf">16.5</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">hf1</span></div>

<div class="viewcode-block" id="get_basic_info"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.get_basic_info">[docs]</a><span class="k">def</span> <span class="nf">get_basic_info</span><span class="p">(</span><span class="n">fileC</span><span class="p">,</span> <span class="n">boxZN</span><span class="p">,</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	For a HMF measurement, this function returns all the basic information about the simulation used:</span>
<span class="sd">	- a HMF model with the corrected sigma8 value: hf,</span>
<span class="sd">	- size of the box: boxLength, boxLengthComoving</span>
<span class="sd">	- name of the simulation used later when writing results boxName</span>
<span class="sd">	- the redshiftof the measured HMF: boxRedshift, 7</span>
<span class="sd">	- the logmass of one particle: logmp,</span>
<span class="sd">	- correction to the mass measured due to force resolution: massCorrection</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">fileC</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;MD_0.4Gpc&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
		<span class="n">boxName</span><span class="o">=</span><span class="s1">&#39;MD_0.4Gpc&#39;</span>
		<span class="n">nSN</span><span class="p">,</span> <span class="n">aSN</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MD04_DIR&#39;</span><span class="p">],</span><span class="s2">&quot;redshift-list.txt&quot;</span><span class="p">),</span> <span class="n">unpack</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;nSN&#39;</span><span class="p">,</span> <span class="s1">&#39;aSN&#39;</span><span class="p">),</span> <span class="s1">&#39;formats&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;f4&#39;</span><span class="p">)})</span>
		<span class="n">conversion</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span> <span class="n">nSN</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">aSN</span><span class="o">-</span><span class="mi">1</span> <span class="p">]))</span>
		<span class="n">boxRedshift</span> <span class="o">=</span>  <span class="n">conversion</span><span class="p">[</span><span class="n">boxZN</span><span class="p">]</span> 
		<span class="n">hf</span> <span class="o">=</span> <span class="n">get_hf</span><span class="p">(</span><span class="mf">0.8228</span><span class="o">*</span><span class="mf">0.953</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">boxRedshift</span><span class="p">,</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="n">delta_wrt</span><span class="p">)</span>
		<span class="c1"># hf_ref = get_hf(0.8228, boxRedshift, delta_wrt=delta_wrt)</span>
		<span class="n">logmp</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">9.63</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">7</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
		<span class="n">boxLength</span> <span class="o">=</span> <span class="mf">400.</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">efunc</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">)</span>
		<span class="n">massCorrection</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="mf">0.0002</span>
		<span class="n">boxLengthComoving</span> <span class="o">=</span> <span class="mf">400.</span>
		
	<span class="k">elif</span> <span class="n">fileC</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;MD_1Gpc&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="p">:</span>
		<span class="n">boxName</span><span class="o">=</span><span class="s1">&#39;MD_1Gpc&#39;</span>
		<span class="n">nSN</span><span class="p">,</span> <span class="n">aSN</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MD10_DIR&#39;</span><span class="p">],</span><span class="s2">&quot;redshift-list.txt&quot;</span><span class="p">),</span> <span class="n">unpack</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;nSN&#39;</span><span class="p">,</span> <span class="s1">&#39;aSN&#39;</span><span class="p">),</span> <span class="s1">&#39;formats&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;f4&#39;</span><span class="p">)})</span>
		<span class="n">conversion</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span> <span class="n">nSN</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">aSN</span><span class="o">-</span><span class="mi">1</span> <span class="p">]))</span>
		<span class="n">boxRedshift</span> <span class="o">=</span>  <span class="n">conversion</span><span class="p">[</span><span class="n">boxZN</span><span class="p">]</span> 
		<span class="c1">#boxRedshift = 1./boxZN - 1.</span>
		<span class="n">hf</span> <span class="o">=</span> <span class="n">get_hf</span><span class="p">(</span><span class="mf">0.8228</span><span class="o">*</span><span class="mf">1.004</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">boxRedshift</span><span class="p">,</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="n">delta_wrt</span><span class="p">)</span>
		<span class="c1"># hf_ref = get_hf(0.8228, boxRedshift, delta_wrt=delta_wrt)</span>
		<span class="n">logmp</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1.51</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">9</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
		<span class="n">boxLength</span> <span class="o">=</span> <span class="mf">1000.</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">efunc</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">)</span>
		<span class="n">massCorrection</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="mf">0.0005</span>
		<span class="n">boxLengthComoving</span> <span class="o">=</span> <span class="mf">1000.</span>

	<span class="k">elif</span> <span class="n">fileC</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;MD_2.5GpcNW&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="p">:</span>
		<span class="n">boxName</span><span class="o">=</span><span class="s1">&#39;MD_2.5GpcNW&#39;</span>
		<span class="n">nSN</span><span class="p">,</span> <span class="n">aSN</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MD25NW_DIR&#39;</span><span class="p">],</span><span class="s2">&quot;redshift-list.txt&quot;</span><span class="p">),</span> <span class="n">unpack</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;nSN&#39;</span><span class="p">,</span> <span class="s1">&#39;aSN&#39;</span><span class="p">),</span> <span class="s1">&#39;formats&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;f4&#39;</span><span class="p">)})</span>
		<span class="n">conversion</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span> <span class="n">nSN</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">aSN</span><span class="o">-</span><span class="mi">1</span> <span class="p">]))</span>
		<span class="n">boxRedshift</span> <span class="o">=</span>  <span class="n">conversion</span><span class="p">[</span><span class="n">boxZN</span><span class="p">]</span> 
		<span class="n">hf</span> <span class="o">=</span> <span class="n">get_hf</span><span class="p">(</span><span class="mf">0.8228</span><span class="o">*</span><span class="mf">1.01</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">boxRedshift</span><span class="p">,</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="n">delta_wrt</span><span class="p">)</span>
		<span class="c1"># hf_ref = get_hf(0.8228, boxRedshift, delta_wrt=delta_wrt)</span>
		<span class="n">hz</span> <span class="o">=</span> <span class="mf">1.</span><span class="c1"># hf.cosmoMD.H( boxRedshift ).value / 100.</span>
		<span class="n">logmp</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">2.359</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">h</span> <span class="p">)</span>
		<span class="n">boxLength</span> <span class="o">=</span> <span class="mf">2500.</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">efunc</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">)</span>
		<span class="n">massCorrection</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="mf">0.001</span>
		<span class="n">boxLengthComoving</span> <span class="o">=</span> <span class="mf">2500.</span>

	<span class="k">elif</span> <span class="n">fileC</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;MD_4GpcNW&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="p">:</span>
		<span class="n">boxName</span><span class="o">=</span><span class="s1">&#39;MD_4GpcNW&#39;</span>
		<span class="n">nSN</span><span class="p">,</span> <span class="n">redshift40</span><span class="p">,</span> <span class="n">aSN</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MD40NW_DIR&#39;</span><span class="p">],</span><span class="s2">&quot;redshift-list.txt&quot;</span><span class="p">),</span> <span class="n">unpack</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;nSN&#39;</span><span class="p">,</span> <span class="s1">&#39;redshift&#39;</span><span class="p">,</span> <span class="s1">&#39;aSN&#39;</span><span class="p">),</span> <span class="s1">&#39;formats&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;f4&#39;</span><span class="p">,</span> <span class="s1">&#39;f4&#39;</span><span class="p">)})</span>
		<span class="n">conversion</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span> <span class="n">nSN</span><span class="p">,</span> <span class="n">redshift40</span> <span class="p">]))</span>
		<span class="n">boxRedshift</span> <span class="o">=</span>  <span class="n">conversion</span><span class="p">[</span><span class="n">boxZN</span><span class="p">]</span> 
		<span class="n">hf</span> <span class="o">=</span> <span class="n">get_hf</span><span class="p">(</span><span class="mf">0.8228</span><span class="o">*</span><span class="mf">1.008</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">boxRedshift</span><span class="p">,</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="n">delta_wrt</span><span class="p">)</span>
		<span class="c1"># hf_ref = get_hf(0.8228, boxRedshift, delta_wrt=delta_wrt)</span>
		<span class="n">hz</span> <span class="o">=</span> <span class="mf">1.</span><span class="c1"># hf.cosmoMD.H( boxRedshift ).value / 100. </span>
		<span class="n">logmp</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">9.6</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">h</span> <span class="p">)</span>
		<span class="n">boxLength</span> <span class="o">=</span> <span class="mf">4000.</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">efunc</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">)</span>
		<span class="n">boxLengthComoving</span> <span class="o">=</span> <span class="mf">4000.</span>
		<span class="n">massCorrection</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="mf">0.003</span>
	
	<span class="k">elif</span> <span class="n">fileC</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;MD_2.5Gpc&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="p">:</span>
		<span class="n">boxName</span><span class="o">=</span><span class="s1">&#39;MD_2.5Gpc&#39;</span>
		<span class="n">nSN</span><span class="p">,</span> <span class="n">aSN</span><span class="p">,</span> <span class="n">redshift25</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MD25_DIR&#39;</span><span class="p">],</span><span class="s2">&quot;redshift-list.txt&quot;</span><span class="p">),</span> <span class="n">unpack</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;nSN&#39;</span><span class="p">,</span> <span class="s1">&#39;aSN&#39;</span><span class="p">,</span> <span class="s1">&#39;redshift&#39;</span><span class="p">),</span> <span class="s1">&#39;formats&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;f4&#39;</span><span class="p">,</span> <span class="s1">&#39;f4&#39;</span><span class="p">)})</span>
		<span class="n">conversion</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span> <span class="n">nSN</span><span class="p">,</span> <span class="n">redshift25</span> <span class="p">]))</span>
		<span class="n">boxRedshift</span> <span class="o">=</span>  <span class="n">conversion</span><span class="p">[</span><span class="n">boxZN</span><span class="p">]</span> 
		<span class="n">hf</span> <span class="o">=</span> <span class="n">get_hf</span><span class="p">(</span><span class="mf">0.8228</span><span class="o">*</span><span class="mf">1.01</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">boxRedshift</span><span class="p">,</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="n">delta_wrt</span><span class="p">)</span>
		<span class="c1"># hf_ref = get_hf(0.8228, boxRedshift, delta_wrt=delta_wrt)</span>
		<span class="n">hz</span> <span class="o">=</span> <span class="mf">1.</span><span class="c1"># hf.cosmoMD.H( boxRedshift ).value / 100.</span>
		<span class="n">logmp</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">2.359</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
		<span class="n">boxLength</span> <span class="o">=</span> <span class="mf">2500.</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">efunc</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">)</span>
		<span class="n">boxLengthComoving</span> <span class="o">=</span> <span class="mf">2500.</span>
		<span class="n">massCorrection</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="mf">0.001</span>

	<span class="k">elif</span> <span class="n">fileC</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;MD_4Gpc&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="p">:</span>
		<span class="n">boxName</span><span class="o">=</span><span class="s1">&#39;MD_4Gpc&#39;</span>
		<span class="n">nSN</span><span class="p">,</span> <span class="n">redshift40</span><span class="p">,</span> <span class="n">aSN</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MD40_DIR&#39;</span><span class="p">],</span><span class="s2">&quot;redshift-list.txt&quot;</span><span class="p">),</span> <span class="n">unpack</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;nSN&#39;</span><span class="p">,</span> <span class="s1">&#39;redshift&#39;</span><span class="p">,</span> <span class="s1">&#39;aSN&#39;</span><span class="p">),</span> <span class="s1">&#39;formats&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;f4&#39;</span><span class="p">,</span> <span class="s1">&#39;f4&#39;</span><span class="p">)})</span>
		<span class="n">conversion</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span> <span class="n">nSN</span><span class="p">,</span> <span class="n">redshift40</span> <span class="p">]))</span>
		<span class="n">boxRedshift</span> <span class="o">=</span>  <span class="n">conversion</span><span class="p">[</span><span class="n">boxZN</span><span class="p">]</span> 
		<span class="n">hf</span> <span class="o">=</span> <span class="n">get_hf</span><span class="p">(</span><span class="mf">0.8228</span><span class="o">*</span><span class="mf">1.008</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">boxRedshift</span><span class="p">,</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="n">delta_wrt</span><span class="p">)</span>
		<span class="c1"># hf_ref = get_hf(0.8228, boxRedshift, delta_wrt=delta_wrt)</span>
		<span class="n">hz</span> <span class="o">=</span> <span class="mf">1.</span><span class="c1"># hf.cosmoMD.H( boxRedshift ).value / 100.</span>
		<span class="n">logmp</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">9.6</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">10</span> <span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">h</span> <span class="p">)</span>
		<span class="n">boxLength</span> <span class="o">=</span> <span class="mf">4000.</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">efunc</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">)</span>
		<span class="n">boxLengthComoving</span> <span class="o">=</span> <span class="mf">4000.</span>
		<span class="n">massCorrection</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="mf">0.003</span>
	
	<span class="k">elif</span> <span class="n">fileC</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ds14_0&#39;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="p">:</span>
		<span class="n">boxName</span><span class="o">=</span><span class="s1">&#39;DS_8Gpc&#39;</span>
		<span class="n">boxRedshift</span> <span class="o">=</span> <span class="mf">0.</span>
		<span class="n">hf</span> <span class="o">=</span> <span class="n">get_hf_ds</span><span class="p">(</span><span class="mf">0.8355</span><span class="p">,</span> <span class="n">boxRedshift</span><span class="p">,</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="n">delta_wrt</span><span class="p">)</span>
		<span class="c1"># hf_ref = get_hf(0.8228, boxRedshift, delta_wrt=delta_wrt)</span>
		<span class="n">hz</span> <span class="o">=</span> <span class="mf">1.</span><span class="c1"># hf.cosmoMD.H( boxRedshift ).value / 100.</span>
		<span class="n">logmp</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">9.6</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">10</span> <span class="o">/</span><span class="n">cosmoDS</span><span class="o">.</span><span class="n">h</span> <span class="p">)</span>
		<span class="n">boxLength</span> <span class="o">=</span> <span class="mf">8000.</span><span class="o">/</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">h</span><span class="o">/</span><span class="n">cosmoDS</span><span class="o">.</span><span class="n">efunc</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">)</span>
		<span class="n">boxLengthComoving</span> <span class="o">=</span> <span class="mf">8000.</span>
		<span class="n">massCorrection</span> <span class="o">=</span> <span class="mf">1.</span> <span class="c1">#- 0.003</span>
	
	<span class="k">return</span> <span class="n">hf</span><span class="p">,</span> <span class="n">boxLength</span><span class="p">,</span> <span class="n">boxName</span><span class="p">,</span> <span class="n">boxRedshift</span><span class="p">,</span> <span class="n">logmp</span><span class="p">,</span> <span class="n">boxLengthComoving</span><span class="p">,</span> <span class="n">massCorrection</span> </div>

<div class="viewcode-block" id="convert_pkl_mass"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.convert_pkl_mass">[docs]</a><span class="k">def</span> <span class="nf">convert_pkl_mass</span><span class="p">(</span><span class="n">fileC</span><span class="p">,</span> <span class="n">fileS</span><span class="p">,</span> <span class="n">binFile</span><span class="p">,</span> <span class="n">qty</span><span class="o">=</span><span class="s1">&#39;mvir&#39;</span><span class="p">,</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Creates a fits file with each measurements made. It linksglobal parameters to the HMF values.</span>
<span class="sd">	:param qty: one point function variable.Default: mvir.</span>
<span class="sd">	:param fileC: file with the central halo statistics</span>
<span class="sd">	:param fileS: file with the satelitte halo statistics</span>
<span class="sd">	:param binFile: file with the bins</span>
<span class="sd">	:return: a fits table containing the one point function histograms</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1">#print &quot;qty&quot;, qty</span>
	<span class="n">boxZN</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fileC</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
	<span class="c1">#print boxZN</span>
	<span class="n">extraName</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fileS</span><span class="p">)[:</span><span class="o">-</span><span class="mi">27</span><span class="p">]</span>
	<span class="n">hf</span><span class="p">,</span> <span class="n">boxLength</span><span class="p">,</span> <span class="n">boxName</span><span class="p">,</span> <span class="n">boxRedshift</span><span class="p">,</span> <span class="n">logmp</span><span class="p">,</span> <span class="n">boxLengthComoving</span><span class="p">,</span> <span class="n">massCorrection</span> <span class="o">=</span> <span class="n">get_basic_info</span><span class="p">(</span><span class="n">fileC</span><span class="p">,</span> <span class="n">boxZN</span><span class="p">,</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
	
	<span class="c1">#print boxName</span>
	<span class="n">bins</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="mi">10</span><span class="o">**</span><span class="n">n</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">binFile</span><span class="p">)</span> <span class="o">*</span> <span class="n">massCorrection</span> <span class="p">)</span>
	<span class="c1">#bins = n.log10( 10**bins_in / hz )</span>
	<span class="c1">#bins = n.loadtxt(binFile)</span>
	<span class="n">logmass</span> <span class="o">=</span> <span class="p">(</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="o">+</span> <span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
	<span class="n">mass</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">logmass</span> 
	<span class="n">dX</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">10</span><span class="o">**</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="o">-</span> <span class="mi">10</span><span class="o">**</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
	<span class="c1">#dlnbin = dX / mass</span>
	<span class="n">dlnbin</span> <span class="o">=</span> <span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="o">-</span> <span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
	<span class="c1">#print dX / mass, dlnbin</span>
	<span class="c1">#selects meaningful masses 10 times particle mass</span>
	<span class="n">ok</span> <span class="o">=</span> <span class="p">(</span><span class="n">logmass</span> <span class="o">&gt;</span> <span class="n">logmp</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">logmass</span><span class="o">&lt;</span><span class="mf">16.1</span><span class="p">)</span>
	<span class="c1">#print &quot;bins&quot;, len(bins), bins</span>
	<span class="c1">#print &quot;bins[ok]&quot;, len(bins[:-1][ok]), bins[:-1][ok]</span>
	<span class="n">hz</span> <span class="o">=</span> <span class="n">cosmoMD</span><span class="o">.</span><span class="n">H</span><span class="p">(</span> <span class="n">boxRedshift</span> <span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="mf">100.</span>
	<span class="c1"># m sigma relation using the sigma8 corrected power spectrum</span>
	<span class="n">m2sigma</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="n">hf</span><span class="o">.</span><span class="n">sigma</span> <span class="p">)</span>
	<span class="n">sig</span> <span class="o">=</span> <span class="n">m2sigma</span><span class="p">(</span> <span class="n">mass</span> <span class="p">)</span>
	<span class="c1"># m nu relation: nu = (delta_c / sigma_m)**2</span>
	<span class="n">m2nu</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="n">hf</span><span class="o">.</span><span class="n">nu</span> <span class="p">)</span>
	<span class="n">nnu</span> <span class="o">=</span> <span class="n">m2nu</span><span class="p">(</span> <span class="n">mass</span> <span class="p">)</span>
	<span class="c1"># jacobian</span>
	<span class="n">toderive</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">M</span><span class="p">),</span> <span class="n">n</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">sigma</span><span class="p">))</span>
	<span class="n">dlnsigmadlnm</span> <span class="o">=</span> <span class="n">derivative</span><span class="p">(</span><span class="n">toderive</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mass</span><span class="p">)</span> <span class="p">)</span>
	<span class="c1">#normalization by average universedensity at this redshift in the right cosmo</span>
	<span class="n">rhom_units</span> <span class="o">=</span> <span class="n">cosmoMD</span><span class="o">.</span><span class="n">Om</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">)</span><span class="o">*</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">critical_density</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">solMass</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Mpc</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span><span class="p">)</span><span class="c1">#/(cosmoMD.h)**2.</span>
	<span class="c1"># in units (Msun/h) / (Mpc/h)**3</span>
	<span class="n">rhom</span> <span class="o">=</span> <span class="n">rhom_units</span><span class="o">.</span><span class="n">value</span> <span class="c1"># hf.mean_density#/(hz)**2. </span>
	<span class="c1">#print hf.mean_density, rhom / (hf.mean_density*(cosmoMD.h)**2.)</span>
	
	<span class="n">col0</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;boxName&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;14A&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">boxName</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">ok</span><span class="p">]))]))</span>
	<span class="n">col1</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;redshift&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">boxRedshift</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">ok</span><span class="p">])</span> <span class="p">)</span> <span class="p">)</span>
	<span class="n">col1b</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">hz</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">ok</span><span class="p">])</span> <span class="p">)</span> <span class="p">)</span>
	<span class="n">col2a</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;boxLengthProper&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">boxLength</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">ok</span><span class="p">])</span> <span class="p">)</span> <span class="p">)</span>
	<span class="n">col2b</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;boxLengthComoving&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">boxLengthComoving</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">ok</span><span class="p">])</span> <span class="p">)</span> <span class="p">)</span>
	<span class="n">col3</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;logMpart&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span>  <span class="n">logmp</span><span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">ok</span><span class="p">])</span> <span class="p">)</span> <span class="p">)</span>
	<span class="n">col4</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rhom&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">rhom</span><span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">ok</span><span class="p">])</span> <span class="p">)</span> <span class="p">)</span>
	<span class="c1">#print &quot;bin test&quot;, bins[:-1][ok]</span>
	<span class="n">col5_0</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;log_&quot;</span><span class="o">+</span><span class="n">qty</span><span class="o">+</span><span class="s2">&quot;_min&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">col5_1</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;log_&quot;</span><span class="o">+</span><span class="n">qty</span><span class="o">+</span><span class="s2">&quot;_max&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">col5_2</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;log_&quot;</span><span class="o">+</span><span class="n">qty</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">logmass</span><span class="p">[</span><span class="n">ok</span><span class="p">])</span>
	<span class="c1">#print &quot;test2&quot;, len( logmass[ok]), logmass[ok]</span>
	<span class="c1">#print &quot;columns&quot;, col5_0, col5_1, col5_2</span>
	<span class="c1">#print &quot;array&quot;, col5_0.array, col5_1.array, col5_2.array</span>
	<span class="n">col5_3</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sigmaM&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">sig</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">col5_4</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;nu2&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">nnu</span><span class="p">[</span><span class="n">ok</span><span class="p">])</span><span class="c1">#hf.delta_c/sig ) # hf.growth_factor/</span>
	<span class="n">col5_5</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dlnsigmaMdlnM&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">dlnsigmadlnm</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>
	
	<span class="n">unitVolume</span> <span class="o">=</span>  <span class="p">(</span><span class="n">boxLength</span> <span class="o">*</span><span class="mf">0.10</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span> <span class="c1"># /cosmoMD.H(boxRedshift)</span>
	<span class="n">volume</span> <span class="o">=</span> <span class="p">(</span><span class="n">boxLength</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span>

	<span class="n">Ncounts</span><span class="p">,</span> <span class="n">Ncounts_c</span><span class="p">,</span> <span class="n">Nall</span><span class="p">,</span> <span class="n">Nall_c</span><span class="p">,</span> <span class="n">mean90</span><span class="p">,</span> <span class="n">std90</span><span class="p">,</span> <span class="n">mean90_c</span><span class="p">,</span> <span class="n">std90_c</span> <span class="o">=</span> <span class="n">getStat</span><span class="p">(</span><span class="n">fileC</span><span class="p">,</span><span class="n">volume</span><span class="p">,</span><span class="n">unitVolume</span><span class="p">)</span>

	<span class="n">col6c</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dN_counts_cen&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Ncounts</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">col6cc</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dN_counts_cen_c&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Ncounts_c</span><span class="p">[</span><span class="n">ok</span><span class="p">])</span>
	<span class="n">col7c</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dNdV_cen&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Nall</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">col7cc</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dNdV_cen_c&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Nall_c</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">col8c</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dNdlnM_cen&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Nall</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span><span class="o">/</span><span class="n">dlnbin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">col8cc</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dNdlnM_cen_c&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Nall_c</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span><span class="o">/</span><span class="n">dlnbin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">col9c</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;std90_pc_cen&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">std90</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">col9cc</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;std90_pc_cen_c&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">std90_c</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>

	<span class="n">Ncounts</span><span class="p">,</span> <span class="n">Ncounts_c</span><span class="p">,</span> <span class="n">Nall</span><span class="p">,</span> <span class="n">Nall_c</span><span class="p">,</span> <span class="n">mean90</span><span class="p">,</span> <span class="n">std90</span><span class="p">,</span> <span class="n">mean90_c</span><span class="p">,</span> <span class="n">std90_c</span> <span class="o">=</span> <span class="n">getStat</span><span class="p">(</span><span class="n">fileS</span><span class="p">,</span><span class="n">volume</span><span class="p">,</span><span class="n">unitVolume</span><span class="p">)</span>

	<span class="n">col6s</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dN_counts_sat&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Ncounts</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">col6sc</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dN_counts_sat_c&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Ncounts_c</span><span class="p">[</span><span class="n">ok</span><span class="p">])</span>
	<span class="n">col7s</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dNdV_sat&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Nall</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">col7sc</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dNdV_sat_c&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Nall_c</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">col8s</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dNdlnM_sat&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Nall</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span><span class="o">/</span><span class="n">dlnbin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">col8sc</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dNdlnM_sat_c&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Nall_c</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">/</span> <span class="n">dlnbin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">col9s</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;std90_pc_sat&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">std90</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">col9sc</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;std90_pc_sat_c&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">std90_c</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="p">)</span>

	<span class="n">tbhdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">BinTableHDU</span><span class="o">.</span><span class="n">from_columns</span><span class="p">([</span><span class="n">col0</span><span class="p">,</span> <span class="n">col1</span><span class="p">,</span><span class="n">col1b</span><span class="p">,</span> <span class="n">col2a</span><span class="p">,</span> <span class="n">col2b</span><span class="p">,</span> <span class="n">col3</span><span class="p">,</span> <span class="n">col4</span><span class="p">,</span> <span class="n">col5_0</span><span class="p">,</span> <span class="n">col5_1</span><span class="p">,</span> <span class="n">col5_2</span><span class="p">,</span> <span class="n">col5_3</span><span class="p">,</span> <span class="n">col5_4</span><span class="p">,</span> <span class="n">col5_5</span><span class="p">,</span> <span class="n">col6c</span><span class="p">,</span> <span class="n">col7c</span><span class="p">,</span> <span class="n">col8c</span><span class="p">,</span> <span class="n">col9c</span><span class="p">,</span> <span class="n">col6cc</span><span class="p">,</span> <span class="n">col7cc</span><span class="p">,</span> <span class="n">col8cc</span><span class="p">,</span> <span class="n">col9cc</span><span class="p">,</span> <span class="n">col6s</span><span class="p">,</span> <span class="n">col7s</span><span class="p">,</span> <span class="n">col8s</span><span class="p">,</span> <span class="n">col9s</span><span class="p">,</span> <span class="n">col6sc</span><span class="p">,</span> <span class="n">col7sc</span><span class="p">,</span> <span class="n">col8sc</span><span class="p">,</span> <span class="n">col9sc</span> <span class="p">])</span>
	
	<span class="n">prihdr</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span>
	<span class="n">prihdr</span><span class="p">[</span><span class="s1">&#39;AUTHOR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;J. Comparat&#39;</span>
	<span class="n">prihdr</span><span class="p">[</span><span class="s1">&#39;DATE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
	<span class="n">prihdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="n">prihdr</span><span class="p">)</span>
	<span class="n">thdulist</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">([</span><span class="n">prihdu</span><span class="p">,</span> <span class="n">tbhdu</span><span class="p">])</span>
	
	<span class="n">writeName</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MVIR_DIR&#39;</span><span class="p">],</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">boxName</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">qty</span><span class="o">+</span><span class="s2">&quot;.fits&quot;</span><span class="p">)</span>
	<span class="k">print</span> <span class="n">writeName</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">writeName</span><span class="p">):</span>
		<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">writeName</span><span class="p">)</span>
	
	<span class="n">thdulist</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">writeName</span><span class="p">)</span></div>
	<span class="c1">#return hf</span>


<div class="viewcode-block" id="convert_pkl_massFunction_covarianceMatrix"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.convert_pkl_massFunction_covarianceMatrix">[docs]</a><span class="k">def</span> <span class="nf">convert_pkl_massFunction_covarianceMatrix</span><span class="p">(</span><span class="n">fileC</span><span class="p">,</span> <span class="n">binFile</span><span class="p">,</span> <span class="n">qty</span><span class="o">=</span><span class="s1">&#39;mvir&#39;</span><span class="p">,</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">):</span><span class="c1">#, gt14=True):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Return a mass function covariance matrix</span>
<span class="sd">	:param qty: one point function variable.Default: mvir.</span>
<span class="sd">	:param file: file with the central halo statistics</span>
<span class="sd">	:param binFile: file with the bins</span>
<span class="sd">	:return: a fits table containing the one point function histograms</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">print</span> <span class="n">fileC</span>
	<span class="n">boxZN</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fileC</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
	<span class="n">hf</span><span class="p">,</span> <span class="n">boxLength</span><span class="p">,</span> <span class="n">boxName</span><span class="p">,</span> <span class="n">boxRedshift</span><span class="p">,</span> <span class="n">logmp</span><span class="p">,</span> <span class="n">boxLengthComoving</span><span class="p">,</span> <span class="n">massCorrection</span> <span class="o">=</span> <span class="n">get_basic_info</span><span class="p">(</span><span class="n">fileC</span><span class="p">,</span> <span class="n">boxZN</span><span class="p">,</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
	<span class="n">bins</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="mi">10</span><span class="o">**</span><span class="n">n</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">binFile</span><span class="p">)</span> <span class="o">*</span> <span class="n">massCorrection</span> <span class="p">)</span>
	<span class="n">logmass</span> <span class="o">=</span> <span class="p">(</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="o">+</span> <span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
	<span class="n">mass</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">logmass</span> 
	<span class="n">dX</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">10</span><span class="o">**</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="o">-</span> <span class="mi">10</span><span class="o">**</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">dlnbin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="o">-</span> <span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
	<span class="c1">#selects meaningful masses 10 times particle mass</span>
	<span class="n">hz</span> <span class="o">=</span> <span class="n">cosmoMD</span><span class="o">.</span><span class="n">H</span><span class="p">(</span> <span class="n">boxRedshift</span> <span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="mf">100.</span>
	<span class="c1"># m sigma relation using the sigma8 corrected power spectrum</span>
	<span class="n">m2sigma</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="n">hf</span><span class="o">.</span><span class="n">sigma</span> <span class="p">)</span>
	<span class="n">sig</span> <span class="o">=</span> <span class="n">m2sigma</span><span class="p">(</span> <span class="n">mass</span> <span class="p">)</span>
	<span class="c1"># m nu relation: nu = (delta_c / sigma_m)**2</span>
	<span class="n">m2nu</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="n">hf</span><span class="o">.</span><span class="n">nu</span> <span class="p">)</span>
	<span class="n">nnu</span> <span class="o">=</span> <span class="n">m2nu</span><span class="p">(</span> <span class="n">mass</span> <span class="p">)</span>
	<span class="c1"># jacobian</span>
	<span class="n">toderive</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">M</span><span class="p">),</span> <span class="n">n</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">sigma</span><span class="p">))</span>
	<span class="n">dlnsigmadlnm</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">toderive</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mass</span><span class="p">)</span> <span class="p">))</span>
	<span class="c1">#normalization by average universedensity at this redshift in the right cosmo</span>
	<span class="n">rhom_units</span> <span class="o">=</span> <span class="n">cosmoMD</span><span class="o">.</span><span class="n">Om</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">)</span><span class="o">*</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">critical_density</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">solMass</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Mpc</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span><span class="p">)</span>
	<span class="n">rhom</span> <span class="o">=</span> <span class="n">rhom_units</span><span class="o">.</span><span class="n">value</span> <span class="c1"># hf.mean_density#/(hz)**2. </span>

	<span class="n">unitVolume</span> <span class="o">=</span>  <span class="p">(</span><span class="n">boxLength</span> <span class="o">*</span><span class="mf">0.10</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span>
	<span class="n">volume</span> <span class="o">=</span> <span class="p">(</span><span class="n">boxLength</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span>

	<span class="n">data_i</span><span class="o">=</span><span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">fileC</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">))</span>
	<span class="n">Ncounts_i</span> <span class="o">=</span> <span class="n">data_i</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
	<span class="n">ok</span> <span class="o">=</span> <span class="p">(</span><span class="n">logmass</span> <span class="o">&gt;</span> <span class="n">logmp</span><span class="o">+</span><span class="mf">3.0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">logmass</span><span class="o">&lt;</span><span class="mf">16.1</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">Ncounts_i</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">)</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	if gt14:</span>
<span class="sd">		ok = (logmass &gt; 13.9)&amp;(logmass&lt;16.1)&amp;(Ncounts_i&gt;10)</span>
<span class="sd">	else:</span>
<span class="sd">		ok = (logmass &gt; logmp+3.0)&amp;(logmass&lt;13.9)&amp;(Ncounts_i&gt;10)</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">data</span> <span class="o">=</span> <span class="n">data_i</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
	<span class="c1">#print data.shape</span>
	<span class="n">Ncounts</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
	<span class="c1">#print Ncounts.shape</span>
	<span class="n">Nall</span> <span class="o">=</span> <span class="n">Ncounts</span> <span class="o">/</span> <span class="n">volume</span>
	<span class="c1">#print Nall.shape</span>
	<span class="n">dNdlnM</span> <span class="o">=</span> <span class="n">Nall</span><span class="o">/</span><span class="n">dlnbin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
	<span class="c1">#print dNdlnM.shape</span>

	<span class="n">count_matrix</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">Ncounts</span><span class="p">,</span> <span class="n">Ncounts</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
	<span class="c1">#print count_matrix.shape</span>
	
	<span class="n">dNdlnM_mat</span> <span class="o">=</span> <span class="n">data</span><span class="o">/</span><span class="n">unitVolume</span><span class="o">/</span><span class="n">dlnbin</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
	<span class="c1">#print dNdlnM_mat.shape</span>
	
	<span class="n">f_mean</span> <span class="o">=</span> <span class="n">mass</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">dNdlnM</span> <span class="o">/</span> <span class="n">rhom</span> <span class="o">/</span> <span class="n">dlnsigmadlnm</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
	<span class="c1">#print f_mean.shape</span>
	<span class="n">f_matrix</span> <span class="o">=</span> <span class="n">mass</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">*</span> <span class="n">dNdlnM_mat</span> <span class="o">/</span> <span class="n">rhom</span> <span class="o">/</span> <span class="n">dlnsigmadlnm</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span>
	<span class="c1">#print f_matrix.shape</span>
	<span class="c1">#print boxName	</span>
	<span class="k">return</span> <span class="p">[</span><span class="n">f_mean</span><span class="p">,</span> <span class="n">f_matrix</span><span class="p">,</span> <span class="n">count_matrix</span><span class="p">,</span> <span class="n">sig</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span> <span class="n">mass</span><span class="p">[</span><span class="n">ok</span><span class="p">]],</span> <span class="n">boxName</span></div>


<div class="viewcode-block" id="convert_pkl_velocity"><a class="viewcode-back" href="../lib_functions_1pt.html#lib_functions_1pt.convert_pkl_velocity">[docs]</a><span class="k">def</span> <span class="nf">convert_pkl_velocity</span><span class="p">(</span><span class="n">fileC</span><span class="p">,</span> <span class="n">fileS</span><span class="p">,</span> <span class="n">binFile</span><span class="p">,</span> <span class="n">qty</span><span class="o">=</span><span class="s1">&#39;vmax&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	:param qty: one point function variable. Default vmax.</span>
<span class="sd">	:param fileC: file with the central halo statistics</span>
<span class="sd">	:param fileS: file with the satelitte halo statistics</span>
<span class="sd">	:param binFile: file with the bins</span>
<span class="sd">	:param zList_files: list of file with linking snapshot number and redshift</span>
<span class="sd">	:return: a fits table containing the one point function histograms</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">print</span> <span class="s2">&quot;qty&quot;</span><span class="p">,</span> <span class="n">qty</span>
	<span class="n">boxZN</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fileC</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
	<span class="k">print</span> <span class="n">boxZN</span>
	<span class="n">extraName</span> <span class="o">=</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fileS</span><span class="p">)[:</span><span class="o">-</span><span class="mi">27</span><span class="p">]</span>
	<span class="n">hf</span><span class="p">,</span> <span class="n">boxLength</span><span class="p">,</span> <span class="n">boxName</span><span class="p">,</span> <span class="n">boxRedshift</span><span class="p">,</span> <span class="n">logmp</span><span class="p">,</span> <span class="n">boxLengthComoving</span><span class="p">,</span> <span class="n">massCorrection</span> <span class="o">=</span> <span class="n">get_basic_info</span><span class="p">(</span><span class="n">fileC</span><span class="p">,</span> <span class="n">boxZN</span><span class="p">,</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
	
	<span class="n">bins</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">binFile</span><span class="p">)</span>
	<span class="n">vmax</span> <span class="o">=</span> <span class="p">(</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="o">+</span> <span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
	<span class="n">dX</span> <span class="o">=</span> <span class="p">(</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="o">-</span> <span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> 
	<span class="n">dlnbin</span> <span class="o">=</span> <span class="n">dX</span> <span class="o">/</span> <span class="n">vmax</span>
	
	<span class="n">hz</span> <span class="o">=</span> <span class="n">cosmoMD</span><span class="o">.</span><span class="n">H</span><span class="p">(</span> <span class="n">boxRedshift</span> <span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="mf">100.</span>
	<span class="n">rhom_units</span> <span class="o">=</span> <span class="n">cosmoMD</span><span class="o">.</span><span class="n">Om</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">)</span><span class="o">*</span><span class="n">cosmoMD</span><span class="o">.</span><span class="n">critical_density</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">solMass</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Mpc</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span><span class="p">)</span><span class="c1">#/(cosmoMD.h)**2.</span>
	<span class="c1"># in units (Msun/h) / (Mpc/h)**3</span>
	<span class="n">rhom</span> <span class="o">=</span> <span class="n">rhom_units</span><span class="o">.</span><span class="n">value</span> 
	
	<span class="n">col0</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;boxName&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;14A&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">boxName</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))]))</span>
	<span class="n">col1</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;redshift&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">boxRedshift</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span> <span class="p">)</span>
	<span class="n">col1b</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">hz</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span> <span class="p">)</span>
	<span class="n">col2a</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;boxLengthProper&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">boxLength</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span> <span class="p">)</span>
	<span class="n">col2b</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;boxLengthComoving&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">boxLengthComoving</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span> <span class="p">)</span>
	<span class="n">col3</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;logMpart&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span>  <span class="n">logmp</span><span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span> <span class="p">)</span>
	<span class="n">col4</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rhom&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">rhom</span><span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span> <span class="p">)</span>

	<span class="n">col5_0</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="n">qty</span><span class="o">+</span><span class="s2">&quot;_min&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
	<span class="n">col5_1</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="n">qty</span><span class="o">+</span><span class="s2">&quot;_max&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">)</span>
	<span class="n">col5_2</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="n">qty</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">vmax</span><span class="p">)</span>

	<span class="n">unitVolume</span> <span class="o">=</span>  <span class="p">(</span><span class="n">boxLength</span><span class="o">*</span><span class="mf">0.10</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span>
	<span class="n">volume</span> <span class="o">=</span> <span class="p">(</span><span class="n">boxLength</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span>

	<span class="n">Ncounts</span><span class="p">,</span> <span class="n">Ncounts_c</span><span class="p">,</span> <span class="n">Nall</span><span class="p">,</span> <span class="n">Nall_c</span><span class="p">,</span> <span class="n">mean90</span><span class="p">,</span> <span class="n">std90</span><span class="p">,</span> <span class="n">mean90_c</span><span class="p">,</span> <span class="n">std90_c</span> <span class="o">=</span> <span class="n">getStat</span><span class="p">(</span><span class="n">fileC</span><span class="p">,</span><span class="n">volume</span><span class="p">,</span><span class="n">unitVolume</span><span class="p">)</span>

	<span class="n">col5</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dN_counts_cen&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Ncounts</span> <span class="p">)</span>
	<span class="n">col6</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dN_counts_cen_c&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Ncounts_c</span><span class="p">)</span>
	<span class="n">col7</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dNdV_cen&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Nall</span> <span class="p">)</span>
	<span class="n">col8</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dNdV_cen_c&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Nall_c</span> <span class="p">)</span>
	<span class="n">col9</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dNdVdlnV_cen&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Nall</span><span class="o">/</span><span class="n">dlnbin</span> <span class="p">)</span>
	<span class="n">col10</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dNdVdlnV_cen_c&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Nall_c</span><span class="o">/</span><span class="n">dlnbin</span> <span class="p">)</span>
	<span class="n">col11</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;std90_pc_cen&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">std90</span> <span class="p">)</span>
	<span class="n">col12</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;std90_pc_cen_c&quot;</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">std90_c</span> <span class="p">)</span>

	<span class="n">Ncounts</span><span class="p">,</span> <span class="n">Ncounts_c</span><span class="p">,</span> <span class="n">Nall</span><span class="p">,</span> <span class="n">Nall_c</span><span class="p">,</span> <span class="n">mean90</span><span class="p">,</span> <span class="n">std90</span><span class="p">,</span> <span class="n">mean90_c</span><span class="p">,</span> <span class="n">std90_c</span> <span class="o">=</span> <span class="n">getStat</span><span class="p">(</span><span class="n">fileS</span><span class="p">,</span><span class="n">volume</span><span class="p">,</span><span class="n">unitVolume</span><span class="p">)</span>

	<span class="n">col5_s</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dN_counts_sat&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Ncounts</span> <span class="p">)</span>
	<span class="n">col6_s</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dN_counts_sat_c&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Ncounts_c</span><span class="p">)</span>
	<span class="n">col7_s</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dNdV_sat&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Nall</span> <span class="p">)</span>
	<span class="n">col8_s</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dNdV_sat_c&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Nall_c</span> <span class="p">)</span>
	<span class="n">col9_s</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dNdVdlnV_sat&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Nall</span><span class="o">/</span><span class="n">dlnbin</span> <span class="p">)</span>
	<span class="n">col10_s</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dNdVdlnV_sat_c&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">Nall_c</span> <span class="o">/</span> <span class="n">dlnbin</span> <span class="p">)</span>
	<span class="n">col11_s</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;std90_pc_sat&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">std90</span> <span class="p">)</span>
	<span class="n">col12_s</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;std90_pc_sat_c&quot;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span> <span class="n">std90_c</span><span class="p">)</span>

	<span class="n">tbhdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">BinTableHDU</span><span class="o">.</span><span class="n">from_columns</span><span class="p">([</span><span class="n">col0</span><span class="p">,</span> <span class="n">col1</span><span class="p">,</span><span class="n">col1b</span><span class="p">,</span> <span class="n">col2a</span><span class="p">,</span> <span class="n">col2b</span><span class="p">,</span> <span class="n">col3</span><span class="p">,</span> <span class="n">col4</span><span class="p">,</span> <span class="n">col5_0</span><span class="p">,</span> <span class="n">col5_1</span><span class="p">,</span> <span class="n">col5_2</span><span class="p">,</span> <span class="n">col5</span><span class="p">,</span> <span class="n">col6</span><span class="p">,</span> <span class="n">col7</span><span class="p">,</span> <span class="n">col8</span><span class="p">,</span> <span class="n">col9</span><span class="p">,</span> <span class="n">col10</span><span class="p">,</span> <span class="n">col11</span><span class="p">,</span> <span class="n">col12</span><span class="p">,</span> <span class="n">col5_s</span><span class="p">,</span> <span class="n">col6_s</span><span class="p">,</span> <span class="n">col7_s</span><span class="p">,</span> <span class="n">col8_s</span><span class="p">,</span> <span class="n">col9_s</span><span class="p">,</span> <span class="n">col10_s</span><span class="p">,</span> <span class="n">col11_s</span><span class="p">,</span> <span class="n">col12_s</span><span class="p">])</span>

	<span class="n">prihdr</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span>
	<span class="n">prihdr</span><span class="p">[</span><span class="s1">&#39;AUTHOR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;J. Comparat&#39;</span>
	<span class="n">prihdr</span><span class="p">[</span><span class="s1">&#39;DATE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
	<span class="n">prihdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">PrimaryHDU</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="n">prihdr</span><span class="p">)</span>
	<span class="n">thdulist</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">HDUList</span><span class="p">([</span><span class="n">prihdu</span><span class="p">,</span> <span class="n">tbhdu</span><span class="p">])</span>

	<span class="n">writeName</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;VMAX_DIR&#39;</span><span class="p">],</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">boxName</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">boxRedshift</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">qty</span><span class="o">+</span><span class="s2">&quot;.fits&quot;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">writeName</span><span class="p">):</span>
		<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">writeName</span><span class="p">)</span>
	
	<span class="n">thdulist</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">writeName</span><span class="p">)</span></div>


<span class="n">redshift</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">hmf</span> <span class="o">=</span> <span class="n">get_hf</span><span class="p">(</span><span class="n">sigma_val</span><span class="o">=</span><span class="mf">0.8228</span><span class="p">,</span> <span class="n">boxRedshift</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">delta_wrt</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">ks</span> <span class="o">=</span> <span class="n">hmf</span><span class="o">.</span><span class="n">k</span>
<span class="n">pks</span> <span class="o">=</span> <span class="n">hmf</span><span class="o">.</span><span class="n">power</span>
<span class="n">nbar</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">hmf</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span> <span class="n">hmf</span><span class="o">.</span><span class="n">rho_gtm</span><span class="o">/</span><span class="n">hmf</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
<span class="n">sigma_to_m</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">hmf</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span> <span class="n">hmf</span><span class="o">.</span><span class="n">M</span><span class="p">)</span>
<span class="n">m_to_sigma</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">hmf</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="n">hmf</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span>
<span class="n">shot_simple</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">volume</span><span class="p">:</span> <span class="p">(</span><span class="n">nbar</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="n">volume</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
<span class="c1">#shot_double_raw = lambda s1, s2, volume: ((nbar(s1)+nbar(s2))/2. * volume)**(-1.)</span>
<span class="n">shot_double_raw</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">volume</span><span class="p">:</span> <span class="p">((</span><span class="n">nbar</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span><span class="o">*</span><span class="n">nbar</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">*</span> <span class="mi">2</span><span class="o">*</span><span class="n">volume</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">shot_double</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">binW</span><span class="p">):</span>
	<span class="n">s1_max</span> <span class="o">=</span> <span class="n">m_to_sigma</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sigma_to_m</span><span class="p">(</span><span class="n">s1</span><span class="p">))</span><span class="o">+</span><span class="n">binW</span><span class="p">))</span>
	<span class="n">s2_max</span> <span class="o">=</span> <span class="n">m_to_sigma</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sigma_to_m</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span><span class="o">+</span><span class="n">binW</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">shot_double_raw</span><span class="p">(</span><span class="n">s1_max</span><span class="p">,</span> <span class="n">s2_max</span><span class="p">,</span> <span class="n">volume</span><span class="p">)</span>
	
<span class="k">def</span> <span class="nf">shot_noise_it</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">volume</span><span class="p">):</span> 
	<span class="k">print</span> <span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">sigma</span>
	<span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sigma_to_m</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span><span class="o">&gt;=</span><span class="mi">14</span><span class="p">:</span>
		<span class="n">s_min</span> <span class="o">=</span> <span class="n">m_to_sigma</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sigma_to_m</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span><span class="o">-</span><span class="mf">0.025</span><span class="p">))</span>
		<span class="n">s_max</span> <span class="o">=</span> <span class="n">m_to_sigma</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sigma_to_m</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span><span class="o">+</span><span class="mf">0.025</span><span class="p">))</span>
		<span class="n">sns</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">shot_simple</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">volume</span><span class="p">),</span> <span class="n">shot_simple</span><span class="p">(</span><span class="n">s_min</span><span class="p">,</span> <span class="n">volume</span><span class="p">),</span> <span class="n">shot_simple</span><span class="p">(</span><span class="n">s_max</span><span class="p">,</span> <span class="n">volume</span><span class="p">)])</span>
		<span class="k">print</span> <span class="n">sns</span>
		<span class="k">return</span> <span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sns</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span> 
		<span class="n">s_min</span> <span class="o">=</span> <span class="n">m_to_sigma</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sigma_to_m</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span><span class="o">-</span><span class="mf">0.125</span><span class="p">))</span>
		<span class="n">s_max</span> <span class="o">=</span> <span class="n">m_to_sigma</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sigma_to_m</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span><span class="o">+</span><span class="mf">0.125</span><span class="p">))</span>
		<span class="n">sns</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">shot_simple</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">volume</span><span class="p">),</span> <span class="n">shot_simple</span><span class="p">(</span><span class="n">s_min</span><span class="p">,</span> <span class="n">volume</span><span class="p">),</span> <span class="n">shot_simple</span><span class="p">(</span><span class="n">s_max</span><span class="p">,</span> <span class="n">volume</span><span class="p">)])</span>
		<span class="k">print</span> <span class="n">sns</span>
		<span class="k">return</span> <span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sns</span><span class="p">)</span>
		
<span class="n">shot_noise</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">volume</span><span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">shot_noise_it</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">volume</span><span class="p">)</span> <span class="k">for</span> <span class="n">sig</span> <span class="ow">in</span> <span class="n">sigma</span><span class="p">])</span>

<span class="n">meanDensity</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3840.</span><span class="o">**</span><span class="mf">3.</span><span class="p">)</span><span class="o">*</span><span class="mf">1.51</span> <span class="c1"># (Msun/h) / (Mpc/h)**3</span>

<span class="k">def</span> <span class="nf">integral</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
	<span class="n">xmin</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fun</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
	<span class="n">xmax</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fun</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
	<span class="n">innerbounds</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
	<span class="n">bounds</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span> <span class="n">innerbounds</span><span class="p">,</span> <span class="n">xmax</span><span class="p">))</span>
	<span class="n">out</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">innerbounds</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
	<span class="n">out_err</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">innerbounds</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">innerbounds</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
		<span class="n">out</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">out_err</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">bounds</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="mi">10</span><span class="o">**</span><span class="n">bounds</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
		 
	<span class="k">return</span> <span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">out_err</span><span class="p">)</span>
		
<span class="c1"># window function, </span>
<span class="c1"># -------------------</span>
<span class="c1"># tophat</span>
<span class="n">w_th</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">r</span> <span class="p">:</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">r</span><span class="p">)</span> <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span>

<span class="c1"># computes the moments of the linear pk for the whole volume</span>
<span class="c1"># ---------------------------------------------</span>
<span class="n">Lboxes</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">400.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">,</span> <span class="mf">2500.</span><span class="p">,</span> <span class="mf">4000.</span><span class="p">,</span> <span class="mf">8000.</span><span class="p">])</span> <span class="c1"># Mpc/h</span>
<span class="n">volumes</span> <span class="o">=</span> <span class="n">Lboxes</span><span class="o">**</span><span class="mf">3.</span>
<span class="n">rboxes</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.</span> <span class="o">*</span> <span class="n">volumes</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span><span class="n">rboxes</span>
<span class="n">sigs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">rbox</span> <span class="ow">in</span> <span class="n">rboxes</span><span class="p">:</span>
	<span class="n">ws_th</span> <span class="o">=</span> <span class="n">w_th</span><span class="p">(</span><span class="n">ks</span><span class="p">,</span> <span class="n">rbox</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span>
	<span class="n">fun</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">ks</span><span class="p">,</span> <span class="n">ws_th</span> <span class="o">*</span> <span class="n">pks</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span><span class="o">/</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ws_th</span><span class="p">))</span>
	<span class="n">sigs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">integral</span><span class="p">(</span><span class="n">fun</span><span class="p">))</span>

<span class="n">covariance_factor</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">sigs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="s2">&quot;cf&quot;</span><span class="p">,</span> <span class="n">covariance_factor</span>

<span class="c1"># computes the moments of the linear pk for 90% of the volume </span>
<span class="c1"># ---------------------------------------------</span>
<span class="n">Lboxes</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">400.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">,</span> <span class="mf">2500.</span><span class="p">,</span> <span class="mf">4000.</span><span class="p">,</span> <span class="mf">8000.</span><span class="p">])</span>
<span class="n">volumes</span> <span class="o">=</span> <span class="n">Lboxes</span><span class="o">**</span><span class="mf">3.</span> <span class="o">*</span><span class="mf">0.9</span>
<span class="n">rboxes</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.</span> <span class="o">*</span> <span class="n">volumes</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;90%&quot;</span><span class="p">,</span><span class="n">rboxes</span>

<span class="n">sigs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">rbox</span> <span class="ow">in</span> <span class="n">rboxes</span><span class="p">:</span>
	<span class="n">ws_th</span> <span class="o">=</span> <span class="n">w_th</span><span class="p">(</span><span class="n">ks</span><span class="p">,</span> <span class="n">rbox</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span>
	<span class="n">fun</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">ks</span><span class="p">,</span> <span class="n">ws_th</span> <span class="o">*</span> <span class="n">pks</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span><span class="o">/</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ws_th</span><span class="p">))</span>
	<span class="n">sigs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">integral</span><span class="p">(</span><span class="n">fun</span><span class="p">))</span>

<span class="n">covariance_factor_90</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">sigs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="s2">&quot;cf&quot;</span><span class="p">,</span> <span class="n">covariance_factor_90</span>

<span class="n">Lboxes</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">400.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">,</span> <span class="mf">2500.</span><span class="p">,</span> <span class="mf">4000.</span><span class="p">,</span> <span class="mf">8000.</span><span class="p">])</span><span class="o">/</span><span class="mf">10.</span> <span class="c1"># Mpc/h</span>
<span class="n">volumes</span> <span class="o">=</span> <span class="n">Lboxes</span><span class="o">**</span><span class="mf">3.</span>
<span class="n">rboxes</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.</span> <span class="o">*</span> <span class="n">volumes</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;1/1000:&quot;</span><span class="p">,</span><span class="n">rboxes</span>

<span class="n">sigs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">rbox</span> <span class="ow">in</span> <span class="n">rboxes</span><span class="p">:</span>
	<span class="n">ws_th</span> <span class="o">=</span> <span class="n">w_th</span><span class="p">(</span><span class="n">ks</span><span class="p">,</span> <span class="n">rbox</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span>
	<span class="n">fun</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">ks</span><span class="p">,</span> <span class="n">ws_th</span> <span class="o">*</span> <span class="n">pks</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span><span class="o">/</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ws_th</span><span class="p">))</span>
	<span class="n">sigs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">integral</span><span class="p">(</span><span class="n">fun</span><span class="p">))</span>

<span class="n">covariance_factor_jk</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">sigs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="s2">&quot;cf&quot;</span><span class="p">,</span> <span class="n">covariance_factor_jk</span> 


<span class="n">Lboxes</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">400.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">,</span> <span class="mf">2500.</span><span class="p">,</span> <span class="mf">4000.</span><span class="p">,</span> <span class="mf">8000.</span><span class="p">])</span><span class="o">/</span><span class="mf">10.</span> <span class="c1"># Mpc/h</span>
<span class="n">volumes</span> <span class="o">=</span> <span class="n">Lboxes</span><span class="o">**</span><span class="mf">3.</span><span class="o">*</span><span class="mf">27.</span>
<span class="n">rboxes</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.</span> <span class="o">*</span> <span class="n">volumes</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>
<span class="k">print</span> <span class="s2">&quot;1/1000:&quot;</span><span class="p">,</span><span class="n">rboxes</span>

<span class="n">sigs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">rbox</span> <span class="ow">in</span> <span class="n">rboxes</span><span class="p">:</span>
	<span class="n">ws_th</span> <span class="o">=</span> <span class="n">w_th</span><span class="p">(</span><span class="n">ks</span><span class="p">,</span> <span class="n">rbox</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span>
	<span class="n">fun</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">ks</span><span class="p">,</span> <span class="n">ws_th</span> <span class="o">*</span> <span class="n">pks</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mf">3.</span><span class="o">/</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ws_th</span><span class="p">))</span>
	<span class="n">sigs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">integral</span><span class="p">(</span><span class="n">fun</span><span class="p">))</span>

<span class="n">covariance_factor_jk2</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">sigs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="s2">&quot;cf&quot;</span><span class="p">,</span> <span class="n">covariance_factor_jk2</span> 
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, johan comparat.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>